<header class="glass-nav bg-white/25 dark:bg-slate-900/25 backdrop-blur-lg border-b border-white/30 dark:border-slate-700/30 shadow-lg transition-all duration-300 sticky top-0 z-30 gemini-header">
  <div class="flex items-center justify-between px-4 md:px-6 py-3 md:py-4">
    <div class="flex items-center gap-2 md:gap-4 flex-1 min-w-0">
      <!-- Menu Toggle Button -->
      <button
        type="button"
        (click)="toggleSidenav.emit()"
        [title]="'เมนู'"
        class="header-icon-btn w-10 h-10 flex items-center justify-center rounded-lg transition-all duration-300 hover:bg-slate-100 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
        <app-icon name="menu" size="md" color="text-slate-700 dark:text-slate-300"></app-icon>
      </button>

      <!-- Logo Section -->
      <div class="flex items-center gap-2 md:gap-3 flex-shrink-0 min-w-0">
        <div class="inline-flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700 shadow-lg flex-shrink-0 relative overflow-hidden">
          <app-icon
            name="business_center"
            size="sm"
            color="text-white"
            class="logo-icon">
          </app-icon>
        </div>
        <div class="flex flex-col min-w-0 hidden sm:block">
          <span class="app-title thai-text font-semibold text-slate-800 dark:text-slate-100 text-sm md:text-lg leading-tight truncate">
            ระบบบริหารทรัพยากรบุคคล
          </span>
          <span class="app-title-en font-medium text-slate-600 dark:text-slate-400 text-xs hidden md:block">
            HR System
          </span>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-2 md:gap-3 flex-shrink-0">
      <!-- Language Switcher -->
      <div class="relative" #languageMenuContainer>
        <button
          type="button"
          (click)="toggleLanguageMenu()"
          [title]="'เปลี่ยนภาษา'"
          class="header-icon-btn relative w-10 h-10 flex items-center justify-center rounded-lg transition-all duration-300 hover:bg-slate-100 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          <app-icon name="language" size="md" color="text-slate-700 dark:text-slate-300"></app-icon>
        </button>

        <!-- Language Dropdown -->
        <div *ngIf="showLanguageMenu"
             class="language-dropdown absolute right-0 top-full mt-2 w-48 bg-white dark:bg-slate-800 rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden">
          <div class="py-1">
            <button
              *ngFor="let lang of languages"
              type="button"
              (click)="changeLanguage(lang.value); showLanguageMenu = false"
              [class.active]="currentLanguage === lang.value"
              class="language-item w-full px-4 py-2.5 text-left flex items-center gap-3 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
              <span class="text-lg">{{ lang.flag }}</span>
              <span class="flex-1 thai-text text-sm font-medium text-slate-700 dark:text-slate-300">{{ lang.label }}</span>
              <app-icon *ngIf="currentLanguage === lang.value" name="check" size="sm" color="text-blue-500"></app-icon>
            </button>
          </div>
        </div>
      </div>

      <!-- Theme Toggle -->
      <app-theme-toggle></app-theme-toggle>

      <!-- Notifications -->
      <div class="relative" #notificationMenu>
        <button
          type="button"
          (click)="toggleNotificationMenu()"
          [title]="'การแจ้งเตือน'"
          class="header-icon-btn relative w-10 h-10 flex items-center justify-center rounded-lg transition-all duration-300 hover:bg-slate-100 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          <app-icon name="notifications" size="md" color="text-slate-700 dark:text-slate-300"></app-icon>
          <span *ngIf="unreadCount > 0"
                class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 dark:bg-red-400 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-lg animate-pulse z-10">
            {{ unreadCount > 9 ? '9+' : unreadCount }}
          </span>
        </button>

        <!-- Notification Dropdown -->
        <div *ngIf="showNotificationMenu"
             class="notification-dropdown absolute right-0 top-full mt-2 w-80 md:w-96 bg-white dark:bg-slate-800 rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 z-50 max-h-96 overflow-hidden flex flex-col">
          <!-- Header -->
          <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between bg-slate-50 dark:bg-slate-900">
            <h3 class="font-semibold text-slate-800 dark:text-slate-200 thai-text">การแจ้งเตือน</h3>
            <button
              *ngIf="unreadCount > 0"
              (click)="markAllAsRead()"
              class="text-xs text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors">
              ทำเครื่องหมายว่าอ่านแล้วทั้งหมด
            </button>
          </div>

          <!-- Notifications List -->
          <div class="overflow-y-auto flex-1">
            <div *ngIf="notifications.length === 0"
                 class="p-8 text-center">
              <app-icon name="notifications_none" size="xl" color="text-slate-400 dark:text-slate-600" class="mb-2 block mx-auto"></app-icon>
              <p class="text-slate-500 dark:text-slate-400 thai-text text-sm">ไม่มีการแจ้งเตือน</p>
            </div>

            <div *ngFor="let notification of notifications"
                 (click)="handleNotificationClick(notification)"
                 [class.unread]="!notification.read"
                 class="notification-item px-4 py-3 border-b border-slate-100 dark:border-slate-700 cursor-pointer transition-all hover:bg-slate-50 dark:hover:bg-slate-700/50">
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0 mt-1">
                  <app-icon
                    [name]="getNotificationIconName(notification.type)"
                    size="md"
                    [color]="getNotificationIconColor(notification.type)"
                    class="notification-icon">
                  </app-icon>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-start justify-between gap-2 mb-1">
                    <h4 class="font-semibold text-sm text-slate-800 dark:text-slate-200 thai-text truncate">
                      {{ notification.title }}
                    </h4>
                    <span *ngIf="!notification.read"
                          class="flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mt-1"></span>
                  </div>
                  <p class="text-xs text-slate-600 dark:text-slate-400 thai-text line-clamp-2 mb-1">
                    {{ notification.message }}
                  </p>
                  <span class="text-xs text-slate-400 dark:text-slate-500">
                    {{ getTimeAgo(notification.timestamp) }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div *ngIf="notifications.length > 0"
               class="px-4 py-2 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-center">
            <button
              class="text-xs text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors">
              ดูทั้งหมด
            </button>
          </div>
        </div>
      </div>

      <!-- User Menu -->
      <div class="relative" #userMenuContainer>
        <button
          type="button"
          (click)="toggleUserMenu()"
          [title]="'เมนูผู้ใช้'"
          class="header-icon-btn relative w-10 h-10 flex items-center justify-center rounded-lg transition-all duration-300 hover:bg-slate-100 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          <app-icon name="account_circle" size="md" color="text-slate-700 dark:text-slate-300"></app-icon>
        </button>

        <!-- User Menu Dropdown -->
        <div *ngIf="showUserMenu"
             class="user-dropdown absolute right-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden">
          <div class="py-1">
            <button
              type="button"
              (click)="onProfile(); showUserMenu = false"
              class="user-menu-item w-full px-4 py-2.5 text-left flex items-center gap-3 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
              <app-icon name="person" size="sm" color="text-slate-600 dark:text-slate-400"></app-icon>
              <span class="thai-text text-sm font-medium text-slate-700 dark:text-slate-300">โปรไฟล์</span>
            </button>
            <button
              type="button"
              (click)="onPreferences(); showUserMenu = false"
              class="user-menu-item w-full px-4 py-2.5 text-left flex items-center gap-3 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
              <app-icon name="settings" size="sm" color="text-slate-600 dark:text-slate-400"></app-icon>
              <span class="thai-text text-sm font-medium text-slate-700 dark:text-slate-300">การตั้งค่า</span>
            </button>
            <div class="border-t border-slate-200 dark:border-slate-700 my-1"></div>
            <button
              type="button"
              (click)="onLogout(); showUserMenu = false"
              class="user-menu-item w-full px-4 py-2.5 text-left flex items-center gap-3 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-red-600 dark:text-red-400">
              <app-icon name="logout" size="sm" color="text-red-600 dark:text-red-400"></app-icon>
              <span class="thai-text text-sm font-medium">ออกจากระบบ</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
