<div class="card main-content-card">
    <div class="card-body">
        <!-- Header -->
        <div class="card-title-container">
            <h4 class="card-title">{{"menu.welfare-history" | translate}}</h4>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="input-group" style="max-width: 250px;">
                <div class="input-group-prepend">
                    <span class="input-group-text">{{"Year" | translate}}</span>
                </div>
                <select class="form-select" style="border: 1px solid var(--border-color);" [(ngModel)]="selectYear"
                    (ngModelChange)="loadData()">
                    <option *ngFor="let y of years" [ngValue]="y">{{y}}</option>
                </select>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="d-flex justify-content-center align-items-center py-5" *ngIf="loading">
            <div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div>
        </div>

        <!-- Desktop Table View -->
        <div class="table-responsive d-none d-lg-block" *ngIf="!loading">
            <table class="table table-hover v-middle">
                <thead class="thead-light">
                    <tr>
                        <th>{{"welfare.Complain Code" | translate}}</th>
                        <th>{{"welfare.Case No" | translate}}</th>
                        <th>{{"welfare.Welfare Code" | translate}}</th>
                        <th>{{"menu.welfare-data" | translate}}</th>
                        <th>{{"welfare.When(Date in bill)" | translate}}</th>
                        <th class="text-end">{{"welfare.Request" | translate}}</th>
                        <th class="text-end">{{"welfare.Approve" | translate}}</th>
                        <th class="text-center">{{"welfare.Status" | translate}}</th>
                        <th class="text-center">{{"welfare.Approve status" | translate}}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngIf="noData">
                        <td colspan="8" class="text-center text-muted py-4">{{"No Data Found" | translate}}</td>
                    </tr>
                    <tr
                        *ngFor="let item of data| slice: (page-1) * pageSize : (page-1) * pageSize + pageSize; let i=index">
                        <td>{{item.complainId}}</td>
                        <td>{{item.caseId}}</td>
                        <td>{{ item.welfare.welId}}</td>
                        <td>{{ translateService.currentLang=='th'? item.welfare.tdesc : item.welfare.edesc}}</td>
                        <td>{{item.occurDate | date: 'dd-MM-yyyy'}}</td>
                        <td class="text-end">{{item.cost | number: '.2'}}</td>
                        <td class="text-end">{{item.reqCost | number: '.2'}}</td>
                        <td class="text-center">
                            <span class="badge" [ngClass]="getStatusBadge(item.status)">
                                {{"systemcpde.welfare.history.status." + item.status | translate}}
                            </span>
                        </td>
                        <td class="text-center">
                            <span class="badge" [ngClass]="getApproveStatusBadge(item.approveStatus)">
                                {{"systemcpde.welfare.history.approvestatus." + item.approveStatus | translate}}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Mobile Card View -->
        <div class="d-lg-none mt-3" *ngIf="!loading">
            <div *ngIf="noData" class="text-center text-muted py-4">{{"No Data Found" | translate}}</div>
            <div *ngFor="let item of data| slice: (page-1) * pageSize : (page-1) * pageSize + pageSize; let i=index"
                class="welfare-card-mobile">
                <div class="card-header">
                    <div class="complain-id">#{{item.complainId}}</div>
                    <div class="date">{{item.occurDate | date: 'dd MMM yyyy'}}</div>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <div class="info-item"><span>{{"welfare.Welfare Code" |
                                translate}}</span><strong>{{item.welfare.welId}}</strong></div>
                        <div class="info-item"><span>{{"welfare.Case No" |
                                translate}}</span><strong>{{item.caseId}}</strong></div>
                    </div>
                    <div class="info-row amounts">
                        <div class="info-item"><span>{{"welfare.Request" | translate}}</span><strong>{{item.cost |
                                number: '.2'}}</strong></div>
                        <div class="info-item"><span>{{"welfare.Approve" | translate}}</span><strong>{{item.reqCost |
                                number: '.2'}}</strong></div>
                    </div>
                    <div class="status-row">
                        <span class="badge" [ngClass]="getStatusBadge(item.status)">
                            {{"systemcpde.welfare.history.status." + item.status | translate}}
                        </span>
                        <span class="badge" [ngClass]="getApproveStatusBadge(item.approveStatus)">
                            {{"systemcpde.welfare.history.approvestatus." + item.approveStatus | translate}}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-controls d-flex justify-content-end p-2" *ngIf="!noData && !loading">
            <select class="form-select" [(ngModel)]="pageSize" (ngModelChange)="page=1">
                <option [ngValue]="10">{{"Items per page"| translate}}: 10</option>
                <option [ngValue]="50">{{"Items per page"| translate}}: 50</option>
                <option [ngValue]="100">{{"Items per page"| translate}}: 100</option>
            </select>
            <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [pageSize]="pageSize" [maxSize]="3"
                [rotate]="true" [boundaryLinks]="true">
                <ng-template ngbPaginationPrevious><i class="mdi mdi-chevron-left"></i></ng-template>
                <ng-template ngbPaginationNext><i class="mdi mdi-chevron-right"></i></ng-template>
            </ngb-pagination>
        </div>
    </div>
</div>

<ng-template #alertModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Alert Message</h5>
        <button type="button" class="close" (click)="closeBtnClick()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        {{msg}}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="closeBtnClick()">OK</button>
    </div>
</ng-template>