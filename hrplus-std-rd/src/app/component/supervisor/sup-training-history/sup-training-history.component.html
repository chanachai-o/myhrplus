<div class="card">
  <div class="card-header bg-myhr">
    <h4>{{ "training.plan.history" | translate }}</h4>
  </div>

  <div class="card-body">
    <form novalidate="" class="form-horizontal">
      <div class="row g-2 align-middle">
        <div class="form-group col-md-2" style="text-align: center; margin-top: 5px;">
          <label class="font-weight-bold text-end control-label col-form-label" style="font-size: 14px;">{{ "subordinate" | translate }}</label>
        </div>

        <div class="form-group col-md-3" style="margin-top: 5px;">
          <ng-template #rt let-r="result" let-t="term">
            {{ r.groupId }}
          </ng-template>

          <input
            placeholder="{{ 'subordinate.group.id' | translate }}"
            id="typeahead-focus"
            type="text"
            class="form-control"
            [(ngModel)]="model"
            (ngModelChange)="changeModel()"
            [ngbTypeahead]="search"
            (focus)="focus$.next($any($event).target.value)"
            (click)="click$.next($any($event).target.value)"
            #instance="ngbTypeahead"
            [inputFormatter]="formatter"
            [resultTemplate]="rt"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>

        <div class="form-group col-md-3" style="margin-top: 5px;">
          <input
            readonly
            type="text"
            class="form-control"
            placeholder="{{ 'subordinate.description' | translate }}"
            id="inputCity"
            [value]="model?.groupId ? (model?.getDesc?.() ?? '') : ''"
          />
        </div>

        <div class="form-group col-md-2 col-6 col-sm-6" style="text-align: left; margin-top: 5px;">
          <button type="button" class="btn btn-info btn-sm btn-circle m-r-5 m-l-10" (click)="refreshData()">
            <i class="fa fa-search"></i>
          </button>
          <button type="button" class="btn btn-danger btn-sm btn-circle" (click)="clearSearch()">
            <i class="fa fa-times"></i>
          </button>
        </div>

        <div class="form-group col-md-2 col-6 col-sm-6" style="margin-top: 5px; text-align: right;">
          <span class="badge badge-light rounded-pill" style="width: 130px; padding: 4px;">
            <p class="badge rounded-pill badge-primary-light p-2">
              {{ 'all' | translate }}
              <span class="text-primary">
                {{ empList?.length ?? 0 }}
              </span>
            </p>
          </span>
        </div>
      </div>
    </form>

    <div class="table-responsive">
      <div class="wrapper">
        <table class="table table-hover table-striped-myhr table-sm mb-0 no-wrap v-middle">
          <thead class="bg-info">
            <tr class="text-white font-weight-normal">
              <th class="font-weight-normal" scope="col">{{ "No." | translate }}</th>
              <th class="font-weight-normal" scope="col">{{ "Employee ID" | translate }}</th>
              <th class="font-weight-normal" scope="col">{{ "Name-Surname" | translate }}</th>
              <th class="font-weight-normal" scope="col">{{ "Position" | translate }}</th>
              <th class="font-weight-normal" scope="col">{{ "Bu1" | translate }}</th>
              <th class="font-weight-normal" scope="col">{{ "Bu2" | translate }}</th>
              <th class="font-weight-normal" scope="col">{{ "Bu3" | translate }}</th>
              <th class="font-weight-normal" scope="col">{{ "Bu4" | translate }}</th>
              <th class="font-weight-normal" scope="col">{{ "Bu5" | translate }}</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngIf="loading">
              <td colspan="9" class="font-weight-normal text-center">
                <div class="justify-content-center text-center" role="status">
                  <div class="spinner-grow text-info" role="status" style="margin: 5px;">
                    <span class="sr-only">Loading...</span>
                  </div>
                  <div class="spinner-grow text-info" role="status" style="margin: 5px;">
                    <span class="sr-only">Loading...</span>
                  </div>
                  <div class="spinner-grow text-info" role="status" style="margin: 5px;">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
              </td>
            </tr>

            <tr
              class="cursor-myhr"
              *ngFor="let emp of empList | slice: (page - 1) * pageSize : (page - 1) * pageSize + pageSize; let i = index; trackBy: trackByEmpId"
              [routerLink]="['/supervisor/sup-emp-training', emp?.employeeId]"
              role="link"
              tabindex="0"
            >
              <td class="align-middle text-center" scope="row">{{ i + 1 + ((page - 1) * pageSize) }}</td>
              <td class="align-middle" style="color: #7460ee;">{{ emp?.employeeId }}</td>

              <!-- ใช้ safe navigation + fallback '-' ทุกคอลัมน์ -->
              <td class="align-middle">{{ emp?.getFullname?.() ?? '-' }}</td>
              <td class="align-middle">{{ emp?.position?.getPositionDesc?.() ?? '-' }}</td>
              <td class="align-middle">{{ emp?.bu1?.getBu1Desc?.() ?? '-' }}</td>
              <td class="align-middle">{{ emp?.bu2?.getBu2Desc?.() ?? '-' }}</td>
              <td class="align-middle">{{ emp?.bu3?.getBu3Desc?.() ?? '-' }}</td>
              <td class="align-middle">{{ emp?.bu4?.getBu4Desc?.() ?? '-' }}</td>
              <td class="align-middle">{{ emp?.bu5?.getBu5Desc?.() ?? '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="d-flex justify-content-end p-2">
      <select class="form-select m-r-5" style="width: auto" [(ngModel)]="pageSize">
        <option [ngValue]="10">{{ "Items per page" | translate }}: 10</option>
        <option [ngValue]="50">{{ "Items per page" | translate }}: 50</option>
        <option [ngValue]="100">{{ "Items per page" | translate }}: 100</option>
      </select>

      <ngb-pagination
        [collectionSize]="collectionSize"
        [(page)]="page"
        [pageSize]="pageSize"
        [maxSize]="3"
        [rotate]="true"
      >
        <ng-template ngbPaginationPrevious>{{ "Prev" | translate }}</ng-template>
        <ng-template ngbPaginationNext>{{ "Next" | translate }}</ng-template>
      </ngb-pagination>
    </div>
  </div>
</div>

<ng-template #alertModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="editLabel">Alert Message</h5>
    <button type="button" class="close" (click)="closeBtnClick()" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    {{ msg }}
  </div>
</ng-template>
