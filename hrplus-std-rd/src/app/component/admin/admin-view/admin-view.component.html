<!-- Modern Admin View Layout -->
<div class="card main-content-card">
  <div class="card-body">
    <!-- Header -->
    <div class="card-title-container">
      <h4 class="card-title">{{ "View Document (present)" | translate }}</h4>
    </div>

    <!-- Filter Section -->
    <div class="filter-container">
      <!-- Employee Filter -->
      <div class="filter-group">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="employeeSwitch" [(ngModel)]="employeeCheckbox">
          <label class="form-check-label" for="employeeSwitch">{{ "Employee" | translate }}</label>
        </div>
        <div class="input-group">
          <input type="text" class="form-control" placeholder="{{ 'Employee ID' | translate }}" [(ngModel)]="employee.employeeId" (ngModelChange)="modelEmployeeChange($event)" [disabled]="!employeeCheckbox">
          <button class="btn btn-outline-secondary btn-icon" (click)="openEmployeeModal()" [disabled]="!employeeCheckbox">
            <i class="mdi mdi-magnify"></i>
          </button>
        </div>
        <input type="text" class="form-control" disabled [value]="employee.getFullname()">
      </div>

      <!-- Workflow Definition Filter -->
      <div class="filter-group">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="definitionSwitch" [(ngModel)]="definitionCheckbox">
          <label class="form-check-label" for="definitionSwitch">{{ "documents.type" | translate }}</label>
        </div>
        <div class="input-group">
          <input type="text" class="form-control" placeholder="{{ 'Workflow ID.WF_REMARK' | translate }}" [(ngModel)]="definition.wfId" (ngModelChange)="modelDefinitionChange($event)" [disabled]="!definitionCheckbox">
          <button class="btn btn-outline-secondary btn-icon" (click)="openDefinitionModal()" [disabled]="!definitionCheckbox">
            <i class="mdi mdi-magnify"></i>
          </button>
        </div>
        <input type="text" class="form-control" disabled [value]="definition.getName()">
      </div>

      <!-- Status Filter -->
      <div class="filter-group">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="statusSwitch" [(ngModel)]="workflowStatusCheckbox">
          <label class="form-check-label" for="statusSwitch">{{ "systemcode.status" | translate }}</label>
        </div>
        <select class="form-select" [(ngModel)]="workflowStatus" [disabled]="!workflowStatusCheckbox">
          <option [ngValue]="{ value: '', tdesc: '', edesc: '' }">{{ 'systemcode.status' | translate }}</option>
          @for (item of workflowStatusList; track item.value) {
            <option [ngValue]="item">{{ getMessageTranslate(item.tdesc, item.edesc) }}</option>
          }
        </select>
      </div>

      <!-- Late Filter -->
      <div class="filter-group">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="lateSwitch" [(ngModel)]="lateCheckbox">
          <label class="form-check-label" for="lateSwitch">{{ "documents.late" | translate }}</label>
        </div>
      </div>

      <!-- Date Filter -->
      <div class="filter-group filter-group-date">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="dateSwitch" [(ngModel)]="dateCheckbox">
          <label class="form-check-label" for="dateSwitch">{{ "Date Full" | translate }}</label>
        </div>
        <div class="date-inputs">
            <div class="input-group">
                <span class="input-group-text">{{ "Start" | translate }}</span>
                <input class="form-control" placeholder="{{ 'dd.mm.yyyy' | translate }}" ngbDatepicker #dps="ngbDatepicker" [(ngModel)]="dateStart" [maxDate]="dateEnd" (dateSelect)="checkBetweenDate()" [disabled]="!dateCheckbox">
                <button class="btn btn-outline-secondary btn-icon" (click)="dps.toggle()" type="button" [disabled]="!dateCheckbox"><i class="mdi mdi-calendar"></i></button>
            </div>
            <div class="input-group">
                <span class="input-group-text">{{ "to2" | translate }}</span>
                <input class="form-control" placeholder="{{ 'dd.mm.yyyy' | translate }}" ngbDatepicker #dpe="ngbDatepicker" [(ngModel)]="dateEnd" [minDate]="dateStart" (dateSelect)="checkBetweenDate()" [disabled]="!dateCheckbox">
                <button class="btn btn-outline-secondary btn-icon" (click)="dpe.toggle()" type="button" [disabled]="!dateCheckbox"><i class="mdi mdi-calendar"></i></button>
            </div>
        </div>
      </div>
    </div>

    <div class="search-button-container">
      <button class="btn btn-primary w-25" (click)="searchWorkflow()">
        <i class="mdi mdi-magnify me-1"></i>
        {{ "systemcode.search" | translate }}
      </button>
    </div>

    <!-- Results Section -->
    <div class="document-view-container">
        <div class="inbox-container">
            <!-- Loading Overlay -->
            @if (workflowListLoading) {
                <div class="loading-container">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                </div>
            }

            <!-- Main Content: List and Detail Panes -->
            <div class="inbox-main-content">
                <!-- Left Pane: Workflow List -->
                <div class="inbox-list-pane" [class.detail-visible]="workflow && !windowWidth(768)">
                    <div class="list-pane-header">
                        <div class="search-input-container input-group input-group-sm">
                            <span class="input-group-text bg-transparent border-0"><i class="mdi mdi-magnify"></i></span>
                            <input type="text" class="form-control border-0 bg-transparent" placeholder="{{ 'systemcode.search' | translate }} {{ 'Doc No.' | translate }}" [(ngModel)]="docNo" (ngModelChange)="changeDocNo($event)">
                        </div>
                        <span class="list-count">{{ 'all' | translate }} {{ workflowList.length }} {{ 'Note(s)' | translate }}</span>
                    </div>

                    <div #workflowDataList class="list-pane-body">
                        @if (workflowList.length > 0) {
                            @for (item of workflowList | slice:(page-1) * pageSize : (page-1) * pageSize + pageSize; track item.wf_seq_no) {
                                <div class="workflow-item" [class.active]="workflow?.wf_seq_no === item.wf_seq_no" (click)="workflow = item; scrollToTop('workflowDataShow')">
                                    <div class="item-avatar">
                                        <img appShowLoading src="{{ rootUrl + '/hr/FileViewer.jsp?uploadfield=memployee.picture&filename=' + item.initiator_pic }}" alt="user" />
                                    </div>
                                    <div class="item-content">
                                        <div class="content-header">
                                            <span class="sender-name" title="{{ item.getInitiatorDesc() }}">{{ item.getInitiatorDesc() }}</span>
                                            <span class="timestamp" [ngbTooltip]="(convertDate(item.date) | thaidate:'fullNotYear') + ' ' + convertTime(item.date)">{{ (convertDate(item.date) | date:'EE') | translate }} {{ convertTime(item.date) }}</span>
                                        </div>
                                        <div class="content-subject" title="{{ item.getSubjectDesc() }}">{{ item.getSubjectDesc() }}</div>
                                        <div class="content-footer">
                                            <span class="doc-no">{{ item.docNo }}</span>
                                            <div class="status-icon" [ngbTooltip]="getWorkflowStatusInfo(item).tooltip | translate">
                                                <i class="mdi" [ngClass]="getWorkflowStatusInfo(item).icon" [style.color]="getWorkflowStatusInfo(item).color"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        } @else if (!workflowListLoading) {
                            <div class="empty-list-message">
                                <i class="mdi mdi-file-search-outline"></i>
                                <h5>{{ 'No Data Found' | translate }}</h5>
                                <p>{{ 'Adjust your filters and search again.' | translate }}</p>
                            </div>
                        }
                    </div>

                    @if (workflowList.length > pageSize) {
                        <div class="list-pane-footer">
                            <ngb-pagination [collectionSize]="workflowList.length" [(page)]="page" [pageSize]="pageSize" [maxSize]="5" [rotate]="true" [ellipses]="false" (pageChange)="scrollToTop('workflowDataList')"></ngb-pagination>
                        </div>
                    }
                </div>

                <!-- Right Pane: Workflow Detail -->
                <div class="inbox-detail-pane" [class.visible]="workflow && !windowWidth(768)">
                    @if (workflow) {
                        <div class="detail-content-wrapper">
                            <div class="detail-header">
                                <button class="btn btn-icon btn-light-secondary back-button" (click)="workflow = undefined"><i class="mdi mdi-arrow-left"></i></button>
                                <h4 class="detail-subject" title="{{ workflow.getSubjectDesc() }}">{{ workflow.getSubjectDesc() }}</h4>
                                <div class="status-icon" [ngbTooltip]="getWorkflowStatusInfo(workflow).tooltip | translate">
                                    <i class="mdi" [ngClass]="getWorkflowStatusInfo(workflow).icon" [style.color]="getWorkflowStatusInfo(workflow).color"></i>
                                </div>
                            </div>
                            <div #workflowDataShow class="detail-body">
                                <app-workflow-type [workflow]="workflow" [fromPage]="''" (newLoading)="searchWorkflow()"></app-workflow-type>
                            </div>
                        </div>
                    } @else {
                        <div class="placeholder">
                            <i class="mdi mdi-file-eye-outline"></i>
                            <h5>{{ 'systemcode.select.workflow' | translate }}</h5>
                            <p>{{ 'Select an item from the list to see the details.' | translate }}</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

  </div>
</div>