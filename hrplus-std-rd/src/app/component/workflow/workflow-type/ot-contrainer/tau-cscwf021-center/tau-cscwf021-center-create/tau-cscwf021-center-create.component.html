<ng-container *ngIf="loading then Loading"></ng-container>
<div class="row" *ngIf="!loading">
  <!-- ส่งถึง -->
  <div class="col-12">
    <app-workflow-sendto (employeeCCId)="employeeCCId=$event" [wfid]="wfid" [cardName]="'systemcode.ot.center.docs.manyday.one'" [menuPage]="'TAU_CSCWF_021_Center'"></app-workflow-sendto>
  </div>
  <!-- ปิดส่งถึง -->
  <!-- รายละเอียดข้อมูลพนักงาน -->
  <div class="col-12">
    <app-workflow-emp-information [employeeId]="empInformation.employeeId" [createBy]="'center'"
      (changeEmpInformation)="empInformation=$event;changeEmpInformation()"></app-workflow-emp-information>
  </div>
  <!-- ปิดรายละเอียดข้อมูลพนักงาน -->
  <!-- รายละเอียดใบขอโอที -->
  <div class="col-12">
    <div class="card mb-0">
      <div class="card-header bg-myhr">
        <h6 class="card-title">{{"Detail" | translate }}</h6>
      </div>
      <div class="card-body">
        <div class="row">
          <ng-container *ngTemplateOutlet="PeriodDate"></ng-container>
          <ng-container *ngTemplateOutlet="PeriodTime"></ng-container>
          <ng-container *ngTemplateOutlet="OtReason"></ng-container>
          <div class="col-12 col-md-6" [ngClass]="{'d-flex justify-content-center':!windowWidth(768)}">
            <div class="form-group">
              <small *ngIf="windowWidth(768)" class="text-muted">&nbsp;</small>
              <div class="input-group mb-3">
                <button type="submit" class="btn btn-info waves-effect waves-light me-1" (click)="generate()"
                  [disabled]="generateError()">
                  Generate
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ng-container *ngIf="otTableListLoading then OtTableListLoading"></ng-container>
  <ng-container *ngIf="!otTableListLoading then OtTable"></ng-container>
  <!-- รายละเอียดใบขอโอที -->
  <!-- หมายเหตุ -->
  <div class="col-12">
    <div class="card mb-0">
      <div class="card-header bg-myhr">
        <h6 class="card-title">
          {{"systemcode.note" | translate}}
        </h6>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-12 col-xs-12 b-r">
            <div class="form-group">
              <small class="text-muted">
                {{"systemcode.note"| translate}}
              </small>
              <textarea class="form-control" rows="2" style="resize: none;" [(ngModel)]="remark"
                placeholder='{{"systemcode.note"| translate}}'></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- ปิดหมายเหตุ -->
  <!-- เอกสารอ้างอิง -->
  <div class="col-12" *ngIf="runno&&workflowData">
    <app-workflow-create-doc-reference [inputs]="inputs" [dynamicComponent]="dynamicComponent"
      [workflowData]="workflowData" (runno)="runno=$event">
    </app-workflow-create-doc-reference>
  </div>
  <!-- ปิดเอกสารอ้างอิง -->
  <!-- แนบไฟล์ -->
  <div class="col-12">
    <app-workflow-attach-file [nameFile]="nameFile" [timestampFile]="timestampFile"
      (changeTimestampFile)="timestampFile=$event"></app-workflow-attach-file>
  </div>
  <!-- ปิดแนบไฟล์ -->
  <!-- ยืนยัน -->
  <div class="card-body ">
    <div class="d-flex no-block align-items-center justify-content-center">
      <div class="action-form">
        <div class="form-group m-b-0 text-center">
          <button type="submit" class="btn btn-success waves-effect waves-light" [disabled]="submitError()"
            (click)="onSubmit()">
            <i class=" fas fa-check"></i>
            {{"Submit" | translate}}
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- ปิดยืนยัน -->
</div>


<ng-template #PeriodDate>
  <ng-container *ngTemplateOutlet="Pds"></ng-container>
  <ng-container *ngTemplateOutlet="Pde"></ng-container>
  <ng-template #Pds>
    <div class="form-group col-12 col-md-6">
      <small class="text-muted">{{"start.date"| translate }}</small>
      <div class="input-group col-12 col-md-7 p-0">
        <input class="form-control border-datepicker"
          oninput="value = value.replace(/[^0-9/]/g, '').replace(/^(\d{2})(\d)/g, '$1/$2').replace(/^(\d\/\d{2})(\d)/g, '$1/$2').replace(/^(\d{2}\/\d{2})(\d)/g, '$1/$2').replace(/^(\d*\/\d*\/\d{4})\w/g, '');"
          placeholder="{{'dd.mm.yyyy' | translate}}" name="dpS" ngbDatepicker #dS="ngbDatepicker"
          [(ngModel)]="startDate" (ngModelChange)="startDateChange()">
        <div class="input-group-append">
          <button class="btn btn-outline-info no-shadow" (click)="dS.toggle()" type="button">
            <i class="far fa-calendar-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </ng-template>
  <ng-template #Pde>
    <div class="form-group col-12 col-md-6">
      <small class="text-muted">{{"end.date"| translate }}</small>
      <div class="input-group col-12 col-md-7 p-0">
        <input class="form-control border-datepicker"
          oninput="value = value.replace(/[^0-9/]/g, '').replace(/^(\d{2})(\d)/g, '$1/$2').replace(/^(\d\/\d{2})(\d)/g, '$1/$2').replace(/^(\d{2}\/\d{2})(\d)/g, '$1/$2').replace(/^(\d*\/\d*\/\d{4})\w/g, '');"
          placeholder="{{'dd.mm.yyyy' | translate}}" name="dpE" ngbDatepicker #dE="ngbDatepicker" [(ngModel)]="endDate"
          (ngModelChange)="endDateChange()">
        <div class="input-group-append">
          <button class="btn btn-outline-info no-shadow" (click)="dE.toggle()" type="button">
            <i class="far fa-calendar-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</ng-template>

<ng-template #PeriodTime>
  <ng-container *ngTemplateOutlet="Pts"></ng-container>
  <ng-container *ngTemplateOutlet="Pte"></ng-container>
  <ng-template #Pts>
    <div class="form-group col-12 col-md-6">
      <small class="text-muted">{{"time-start"| translate }}</small>
      <div class="input-group col-12 col-md-7 p-0">
        <input type="time" class="form-control" [(ngModel)]="startTime" (change)="startTimeChange()">
      </div>
    </div>
  </ng-template>
  <ng-template #Pte>
    <div class="form-group col-12 col-md-6">
      <small class="text-muted">{{"time-end"| translate }}</small>
      <div class="input-group col-12 col-md-7 p-0">
        <input type="time" class="form-control" [(ngModel)]="endTime" (change)="endTimeChange()">
      </div>
    </div>
  </ng-template>
</ng-template>

<ng-template #OtReason>
  <div class="form-group col-12 col-md-6">
    <small class="text-muted">{{"systemcode.note" | translate}}</small>
    <div class="input-group col-12 col-md-7 p-0">
      <input [readOnly]="true" type="text" class="form-control" placeholder="{{'detail'| translate}}"
        [value]="reasonOt?reasonOt.getDesc():('detail'| translate)">
      <div class="input-group-append">
        <button class="btn me-0 btn-info" type="button" (click)="openReasonOtModal()">
          <i class="fa fa-search"></i>
        </button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #OtTable>
  <div class="col-12">
    <div class="card mb-0">
      <div class="card-header bg-myhr">
        <h6 class="card-title">
          {{"ot.table" | translate}}
        </h6>
      </div>
      <div class="card-body pe-0 ps-0">
        <div class="table-responsive">
          <div class="wrapper">
            <table class="table  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
              <thead class="bg-info ">
                <tr class="text-white font-weight-normal">
                  <th class="font-weight-normal text-center">
                    <div class="custom-control custom-checkbox">
                      &nbsp;
                      <input type="checkbox" class="custom-control-input" id="checkAll"
                        [(ngModel)]="otTableListCheckBoxAll" (ngModelChange)="otTableListCheckBoxAllChange()">
                      <label class="custom-control-label font-weight-normal" for="checkAll">
                      </label>
                    </div>
                  </th>
                  <th class="font-weight-normal text-center" scope="col">{{"Start Date" | translate }}</th>
                  <th class="font-weight-normal text-center" scope="col">{{"Start Time" | translate }}</th>
                  <th class="font-weight-normal text-center" scope="col">{{"end.date" | translate }}</th>
                  <th class="font-weight-normal text-center" scope="col">{{"End Time" | translate }}</th>
                  <th class="font-weight-normal text-center" scope="col">{{"systemcode.ot.reason" | translate }}</th>
                  <th class="font-weight-normal text-center" scope="col">
                    {{"Shift Work" | translate }}
                  </th>
                  <th class="font-weight-normal text-center" scope="col"></th>
                </tr>
              </thead>
              <tbody>
                <tr
                  *ngFor="let item of otTableList | slice: (page-1) * pageSize : ((page-1) * pageSize) + pageSize;; let i=index">
                  <td class="font-weight-normal text-center">
                    <div class="custom-control custom-checkbox">
                      &nbsp;
                      <input type="checkbox" class="custom-control-input"
                        [id]="'checkboxAccept'+(((page-1) * pageSize)+(i+1))" [(ngModel)]="item.checkbox">
                      <label class="custom-control-label font-weight-normal"
                        [for]="'checkboxAccept'+(((page-1) * pageSize)+(i+1))">
                      </label>
                    </div>
                  </td>
                  <td class="align-middle text-center">
                    {{dateShow(item.date.start)}}
                  </td>
                  <td class="align-middle text-center">
                    {{item.time.start}}
                  </td>
                  <td class="align-middle text-center">
                    {{dateShow(item.date.end)}}
                  </td>
                  <td class="align-middle text-center">
                    {{item.time.end}}
                  </td>
                  <td class="align-middle text-center">
                    {{getMessageTranslate(item.reason.tdesc,item.reason.edesc)}}
                  </td>
                  <td class="align-middle text-center">
                    {{getMessageTranslate(item.shift.tdesc,item.shift.edesc)}}
                  </td>
                  <td class="align-middle text-center">
                    <button type="button" class="btn btn-danger btn-sm btn-circle ms-2"
                      (click)="openOtAddEditModal(OtAddEdit,((page-1) * pageSize)+i)">
                      <i class="fas fa-pencil-alt"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="d-flex justify-content-end p-2" *ngIf="otTableList.length>0">
          <select class="form-select m-r-5" style="width: auto" [(ngModel)]="pageSize" (ngModelChange)="page=1">
            <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
            <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
            <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
          </select>
          <ngb-pagination [collectionSize]="otTableList.length" [(page)]="page" [pageSize]="pageSize" [maxSize]="3"
            [rotate]="true">
            <ng-template ngbPaginationPrevious>{{"Prev" | translate}}</ng-template>
            <ng-template ngbPaginationNext>{{"Next" | translate}}</ng-template>
          </ngb-pagination>
        </div>
        <div class="col-12 b-r">
          <div class="d-flex no-block align-items-center justify-content-center mb-1 mt-3">
            <div class="action-form">
              <div class="form-group m-b-0 text-center">
                <button type="submit" class="btn-w-100 btn btn-info waves-effect waves-light me-4"
                  (click)="openOtAddEditModal(OtAddEdit)">
                  {{"systemcode.add" | translate}}
                </button>
                <button type="submit" class="btn-w-100 btn btn-danger waves-effect waves-light ms-4"
                  (click)="deleteOtTableList()">
                  {{"systemcode.delete" | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #OtTableListLoading>
  <div class="col-12">
    <div class="card mb-0">
      <div class="card-header bg-myhr">
        <h6 class="card-title">
          {{"ot.table" | translate}}
        </h6>
      </div>
      <div class="card-body pe-0 ps-0">
        <ng-container *ngTemplateOutlet="Loading"></ng-container>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #OtAddEdit let-modal>
  <div class="modal-body">
    <div class="card" style="margin-bottom:-15px">
      <div class="card-header bg-myhr">
        <h5 class="card-title">{{"edit.ot" | translate}}</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <ng-container *ngTemplateOutlet="PeriodDateAddEdit"></ng-container>
          <ng-container *ngTemplateOutlet="PeriodTimeAddEdit"></ng-container>
          <ng-container *ngTemplateOutlet="OtReasonAddEdit"></ng-container>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-success" [disabled]="addEditOtTableError()" (click)="addEditOtTableList()">
      {{"systemcode.add" |translate}}</button>
    <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
      {{"Close" |translate}}
    </button>
  </div>
</ng-template>
<ng-template #PeriodDateAddEdit>
  <ng-container *ngTemplateOutlet="PdsAddEdit"></ng-container>
  <ng-container *ngTemplateOutlet="PdeAddEdit"></ng-container>
  <ng-template #PdsAddEdit>
    <div class="form-group col-12 col-md-6">
      <small class="text-muted">{{"start.date"| translate }}</small>
      <div class="input-group col-12 col-md-8 p-0">
        <input class="form-control border-datepicker"
          oninput="value = value.replace(/[^0-9/]/g, '').replace(/^(\d{2})(\d)/g, '$1/$2').replace(/^(\d\/\d{2})(\d)/g, '$1/$2').replace(/^(\d{2}\/\d{2})(\d)/g, '$1/$2').replace(/^(\d*\/\d*\/\d{4})\w/g, '');"
          placeholder="{{'dd.mm.yyyy' | translate}}" name="dpS" ngbDatepicker #dS="ngbDatepicker"
          [(ngModel)]="startDateAddEdit" (ngModelChange)="startDateAddEditChange()">
        <div class="input-group-append">
          <button class="btn btn-outline-info no-shadow" (click)="dS.toggle()" type="button">
            <i class="far fa-calendar-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </ng-template>
  <ng-template #PdeAddEdit>
    <div class="form-group col-12 col-md-6">
      <small class="text-muted">{{"end.date"| translate }}</small>
      <div class="input-group col-12 col-md-8 p-0">
        <input class="form-control border-datepicker"
          oninput="value = value.replace(/[^0-9/]/g, '').replace(/^(\d{2})(\d)/g, '$1/$2').replace(/^(\d\/\d{2})(\d)/g, '$1/$2').replace(/^(\d{2}\/\d{2})(\d)/g, '$1/$2').replace(/^(\d*\/\d*\/\d{4})\w/g, '');"
          placeholder="{{'dd.mm.yyyy' | translate}}" name="dpE" ngbDatepicker #dE="ngbDatepicker"
          [(ngModel)]="endDateAddEdit" disabled>
        <div class="input-group-append">
          <button class="btn btn-outline-info no-shadow" (click)="dE.toggle()" type="button" disabled>
            <i class="far fa-calendar-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</ng-template>

<ng-template #PeriodTimeAddEdit>
  <ng-container *ngTemplateOutlet="PtsAddEdit"></ng-container>
  <ng-container *ngTemplateOutlet="PteAddEdit"></ng-container>
  <ng-template #PtsAddEdit>
    <div class="form-group col-12 col-md-6">
      <small class="text-muted">{{"time-start"| translate }}</small>
      <div class="input-group col-12 col-md-8 p-0">
        <input type="time" class="form-control" [(ngModel)]="startTimeAddEdit" (change)="startTimeAddEditChange()">
      </div>
    </div>
  </ng-template>
  <ng-template #PteAddEdit>
    <div class="form-group col-12 col-md-6">
      <small class="text-muted">{{"time-end"| translate }}</small>
      <div class="input-group col-12 col-md-8 p-0">
        <input type="time" class="form-control" [(ngModel)]="endTimeAddEdit" (change)="endTimeAddEditChange()">
      </div>
    </div>
  </ng-template>
</ng-template>

<ng-template #OtReasonAddEdit>
  <div class="form-group col-12 col-md-6">
    <small class="text-muted">{{"systemcode.note" | translate}}</small>
    <div class="input-group col-12 col-md-8 p-0">
      <input [readOnly]="true" type="text" class="form-control" placeholder="{{'detail'| translate}}"
        [value]="reasonOtAddEdit?reasonOtAddEdit.getDesc():('detail'| translate)">
      <div class="input-group-append">
        <button class="btn me-0 btn-info" type="button" (click)="openReasonOtAddEditModal()">
          <i class="fa fa-search"></i>
        </button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #Loading>
  <div class="col-12 justify-content-center text-center" role="status">
    <div class="spinner-grow text-info" role="status" style="margin: 5px;" *ngFor="let item of [1,2,3]">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</ng-template>
