<div class="justify-content-center text-center" role="status" *ngIf="loading">
  <div class="spinner-grow text-info" role="status" style="margin: 5px;">
    <span class="sr-only">Loading...</span>
  </div>
  <div class="spinner-grow text-info" role="status" style="margin: 5px;">
    <span class="sr-only">Loading...</span>
  </div>
  <div class="spinner-grow text-info" role="status" style="margin: 5px;">
    <span class="sr-only">Loading...</span>
  </div>
</div>


<div *ngIf="!loading ">

  <!-- ใบขอลาหยุดงาน -->
  <div class="row">
    <!-- ส่งถึง -->
    <div class="col-12">
      <app-workflow-sendto (employeeCCId)="employeeCCId=$event" [wfid]="wfid" cardName="systemcode.leave"
        subjectName="{{'systemcode.leave' | translate}}  {{this.empLeaveStatistic?.length>0?'('+this.empLeaveStatistic![this.leaveData]?.getDesc()+')':'(ไม่มีสิทธิการลา)'}}"></app-workflow-sendto>
    </div>
    <!-- รายละเอียดข้อมูลพนักงาน -->
    <div class="col-12" *ngIf="emp">
      <div class="card mb-0">
        <div class="card-header bg-myhr">
          <h6 class="card-title">{{"Employee Detail" | translate}}</h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"Employee ID" | translate}}</small>
              <h6>{{emp.employeeId}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"Name-Surname" | translate}}</small>
              <h6>{{emp.getFullname()}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"Position" | translate}}</small>
              <h6>{{emp.position?.getPositionDesc()?emp.position.getPositionDesc():'-'}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"dashboard.bu1" | translate}}</small>
              <h6>{{emp.bu1?.getBu1Desc()?emp.bu1.getBu1Desc():'-'}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"dashboard.bu2" | translate}}</small>
              <h6>{{emp.bu2?.getBu2Desc()?emp.bu2.getBu2Desc():'-'}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"dashboard.bu3" | translate}}</small>
              <h6>{{emp.bu3?.getBu3Desc()?emp.bu3.getBu3Desc():'-'}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"dashboard.bu4" | translate}}</small>
              <h6>{{emp.bu4?.getBu4Desc()?emp.bu4.getBu4Desc():'-'}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"dashboard.bu5" | translate}}</small>
              <h6>{{emp.bu5?.getBu5Desc()?emp.bu5.getBu5Desc():'-'}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"dashboard.bu6" | translate}}</small>
              <h6>{{emp.bu6?.getBu6Desc()?emp.bu6.getBu6Desc():'-'}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"dashboard.bu7" | translate}}</small>
              <h6>{{emp.bu7?.getBu7Desc()?emp.bu7.getBu7Desc():'-'}}</h6>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"tel" | translate}}</small>
              <h6>{{emp.telExt?emp.telExt:'-'}}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- รายละเอียดการลา -->

    <div class="col-12" *ngIf="empLeaveStatistic?.length > 0">
      <div class="card mb-0">
        <div class="card-header bg-myhr">
          <h6 class="card-title">{{"leave-detail" | translate}}</h6>
        </div>
        <div class="card-body">
          <div class="col-12" style="z-index: 1;position: absolute;top: 50%;text-align: center;">
            <div class="spinner-grow text-info" role="status" style="margin: 5px;"
              *ngIf="loadingCal||loadEmpLeaveStatistic">
              <span class="sr-only">Loading...</span>
            </div>
            <div class="spinner-grow text-info" role="status" style="margin: 5px;"
              *ngIf="loadingCal||loadEmpLeaveStatistic">
              <span class="sr-only">Loading...</span>
            </div>
            <div class="spinner-grow text-info" role="status" style="margin: 5px;"
              *ngIf="loadingCal||loadEmpLeaveStatistic">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <div class="row" *ngIf="!loadEmpLeaveStatistic">
            <div class="col-md-6 col-xs-12 b-r">
              <div class="form-group">
                <small class="text-muted">{{"leave.type" | translate}}</small>
                <select class="form-control col-md-6 col-sm-6 col-lg-6" [(ngModel)]="leaveData" (change)="resetCal()">
                  <option *ngFor="let item of empLeaveStatistic; let i=index" [value]="i">
                    {{item.getDesc()}}
                  </option>
                </select>
              </div>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <small class="text-muted">{{"remain" | translate}} ({{"date-hr-min" | translate}})</small>
              <h6>{{empLeaveStatistic[leaveData].remain}}</h6>
            </div>
            <div class="col-md-12 col-xs-12 b-r">

              <div class="form-group">
                <small class="text-muted">{{"Leave Format" | translate}}</small>
                <div class="form-check">
                  <div class="custom-control custom-radio">
                    <input type="radio" class="custom-control-input" id="leave1" name="radio-stacked" [value]="0"
                      (change)="detailsLeave($event.target.value);resetCal('edit')" [checked]="typeLeave==0"
                      [disabled]="eventgrpModel?.day_leave_stat == 0 ? true : false">
                    <label class="custom-control-label" for="leave1">{{"workflow.format_leave0"|
                      translate}}</label>
                  </div>
                </div>
                <div class="form-check">
                  <div class="custom-control custom-radio">
                    <input type="radio" class="custom-control-input" id="leave2" name="radio-stacked" [value]="1"
                      (change)="detailsLeave($event.target.value);resetCal('edit')" [checked]="typeLeave==1"
                      [disabled]="eventgrpModel?.hour_leave_stat == 0? true : false">
                    <label class="custom-control-label" for="leave2">{{"workflow.format_leave1" |
                      translate}}</label>
                  </div>
                </div>
                <div class="form-check">
                  <div class="custom-control custom-radio">
                    <input type="radio" class="custom-control-input" id="leave3" name="radio-stacked" [value]="2"
                      (change)="detailsLeave($event.target.value);resetCal()" [checked]="typeLeave==2"
                      [disabled]="eventgrpModel?.fhalf_leave_stat == 0? true : false">
                    <label class="custom-control-label" for="leave3">{{"workflow.format_leave2" |
                      translate}}</label>
                  </div>
                </div>
                <div class="form-check">
                  <div class="custom-control custom-radio">
                    <input type="radio" class="custom-control-input" id="leave4" name="radio-stacked" [value]="3"
                      (change)="detailsLeave($event.target.value);resetCal()" [checked]="typeLeave==3"
                      [disabled]="eventgrpModel?.shalf_leave_stat == 0? true : false">
                    <label class="custom-control-label" for="leave4">{{"workflow.format_leave3" |
                      translate }}</label>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-12 col-xs-12 b-r" *ngIf="typeLeave==0 || typeLeave==1">
              <div class="form-group" *ngIf="typeLeave==0">
                <small class="text-muted">{{"full-day-leave" | translate}}</small>
                <input type="number" min="1" max="100" class="form-control col-lg-3 col-md-3 col-sm-6 "
                  (change)="changeTime();numdate>100?numdate=100:numdate" placeholder='{{"day" | translate}}'
                  [(ngModel)]="numdate">
                <small *ngIf="numdate>100" class="text-danger ">{{"systemcode.alert.leave.day" |
                  translate}}</small>
              </div>
              <div class="form-group" *ngIf="typeLeave==1">
                <small class="text-muted">{{"hour-leave" | translate}} {{"(Hr:Min)" |translate}}</small>
                <ngb-timepicker [(ngModel)]="hourleaveTime" [spinners]="spinners" (change)="changeTime();">
                </ngb-timepicker>
                <!-- <small class="text-danger ">{{"Minimum limit (Hours)" |  translate}} {{getMinLeave()}}</small> -->
                <!-- <input  type="time"  class="form-control col-lg-3 col-md-3 col-sm-6 mt-1"
                                [(ngModel)]="hourleave" (change)="changeTime();" placeholder='{{"Hours" | translate}}'
                                > -->
              </div>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <div class="form-group">
                <small class="text-muted">{{"start.date" | translate}}</small>
                <div class="input-group">
                  <input class="form-control col-md-6 col-sm-6 col-lg-6" placeholder="{{'dd.mm.yyyy' | translate}}"
                    name="dp1" (ngModelChange)="changeTime()" [(ngModel)]="selectStartDate" ngbDatepicker
                    #d1="ngbDatepicker" #c1="ngModel"
                    (change)="selectStartDate = datepickerService.validateFormatDate(c1)">
                  <div class="input-group-append">
                    <button class="btn btn-outline-info no-shadow" (click)="d1.toggle()" type="button">
                      <i class="far fa-calendar-alt"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <div class="form-group" *ngIf="fullDay||partial||half">
                <small class="text-muted">{{"end.date" | translate}}</small>
                <div class="input-group">
                  <input readonly class="form-control col-md-6 col-sm-6 col-lg-6"
                    placeholder="{{'dd.mm.yyyy' | translate}}" name="dp2" [(ngModel)]="selectEndDate" ngbDatepicker
                    #d2="ngbDatepicker" [minDate]="selectStartDate" #c2="ngModel"
                    (change)="selectEndDate = datepickerService.validateFormatDate(c2)">
                  <div class="input-group-append">
                    <button disabled class="btn btn-outline-info no-shadow" (click)="d2.toggle()" type="button">
                      <i class="far fa-calendar-alt"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <div class="form-group" *ngIf="fullDay||half">
                <small class="text-muted">{{"time-start" | translate}}</small>
                <input readonly type="time" class="form-control col-md-6 col-sm-6 col-lg-6"
                  [(ngModel)]="selectStartTime">
              </div>
              <div class="form-group" *ngIf="typeLeave==1">
                <small class="text-muted">{{"time-start" | translate}}</small>
                <input type="time" class="form-control col-md-6 col-sm-6 col-lg-6" [(ngModel)]="selectStartTime"
                  (change)="changeTime()" (blur)="checkMinute()">
              </div>
            </div>
            <div class="col-md-6 col-xs-12 b-r">
              <div class="form-group" *ngIf="fullDay||partial||half">
                <small class="text-muted">{{"time-end" | translate}}</small>
                <input readonly type="time" class="form-control col-md-6 col-sm-6 col-lg-6" [(ngModel)]="selectEndTime">
              </div>
            </div>

            <div class="col-md-12 col-xs-12 b-r">
              <div class="d-flex no-block align-items-center mb-1">
                <div class="action-form">
                  <div class="form-group m-b-0 text-center">
                    <button [disabled]="loadingCal" type="submit" class="btn btn-success waves-effect waves-light "
                      (click)="calculate()">
                      <i class=" fas fa-calculator"></i> {{"calculate" |translate}}
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-12 col-xs-12 b-r">
              <div class="form-group">
                <small class="text-muted">{{"leave-reason" | translate}}</small>
                <textarea class="form-control" rows="2" style="resize: none;"
                  placeholder='{{"leave-reason" | translate}}' [(ngModel)]="leaveReason"></textarea>
              </div>
            </div>
            <div class="col-md-12 col-xs-12 b-r">
              <small class="text-muted">{{"Leave Description" | translate}}</small>
              <h6>
                {{get_eventgrpWF_remark(empLeaveStatistic[leaveData].eventgrpid)}}
              </h6>
            </div>
            <app-workflow-remark [wfid]="wfid"></app-workflow-remark>
          </div>
        </div>
      </div>
    </div>
    <!-- เหตุผล -->
    <div class="col-12">
      <div class="card mb-0">
        <div class="card-header bg-myhr">
          <h6 class="card-title">{{"systemcode.note" | translate}}</h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-12 col-xs-12 b-r">
              <div class="form-group">
                <small class="text-muted">{{"systemcode.note"| translate}}</small>
                <textarea class="form-control" rows="2" style="resize: none;" [(ngModel)]="remark"
                  placeholder='{{"systemcode.note"| translate}}'></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- เอกสารอ้างอิง -->
    <div class="col-12" *ngIf="runno&&workflowData">
      <div class="card mb-0">
        <div class="card-header bg-myhr">
          <h6 class="card-title">{{"Doc Reference" | translate}}</h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 col-xs-12 b-r">
              <div class="form-group">
                <h6 class="cursor-myhr" (click)="openRonnoReference()">
                  {{translateService.currentLang=="th"?workflowData.thaiSubject:workflowData.engSubject}}
                  [{{workflowData.doc_no}}]
                </h6>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- แนบไฟล์ -->
    <div class="col-12">
      <app-workflow-attach-file [nameFile]="nameFile" [timestampFile]="timestampFile"
        (changeTimestampFile)="timestampFile=$event"></app-workflow-attach-file>
    </div>
    <!-- สิทธิการลา -->
    <div class="col-12">
      <div class="card mb-0">
        <div class="card-header bg-myhr">
          <div class="d-flex">
            <h6 class="card-title" style="margin-top: 3px;">{{"Privilege Leave" | translate}} </h6>
            <button class="btn btn-success btn-sm  ms-3" (click)="showPrivilegeLeave()"><i
                class="{{showP == 'Show Privilege Leave'  ? 'fas fa-eye-slash' : 'fas fa-eye'}}"></i>
              {{showP | translate}}</button>
          </div>
        </div>
        <div class="card-body" *ngIf="privilegeLeave">
          <div class="row" *ngIf="loadEmpLeaveStatistic">
            <div class="col-12 mt-1" style="z-index: 1;position: absolute;top: 50%;text-align: center;">
              <div class="spinner-grow text-info" role="status" style="margin: 5px;">
                <span class="sr-only">Loading...</span>
              </div>
              <div class="spinner-grow text-info" role="status" style="margin: 5px;">
                <span class="sr-only">Loading...</span>
              </div>
              <div class="spinner-grow text-info" role="status" style="margin: 5px;">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
          </div>

          <!-- <ul ngbNav #navKC="ngbNav"  [(activeId)]="activeKeep" [destroyOnHide]="false" class="nav-tabs" style="background-color: white;padding: 10px 10px 10px 10px;">
            <li [ngbNavItem]="1" [destroyOnHide]="true" *ngIf="!loadEmpLeaveStatistic">
              <a ngbNavLink>{{"table" | translate}}</a>
              <ng-template ngbNavContent>
                <table class="table table-bordered table-sm   no-wrap v-middle "  id="table">
                  <thead class="bg-info " >
                      <tr class="text-white font-weight-normal">
                          <th class="font-weight-normal width-table  align-middle text-center" scope="col"  rowspan="2">{{"Leave Type" | translate}}</th>
                          <th class="font-weight-normal width-table text-center" scope="col" >{{selectYear-1}}</th>
                          <th class="font-weight-normal width-table text-center" scope="col" >{{'menu.employee-leaverole' | translate}}</th>
                          <th class="font-weight-normal width-table text-center" scope="col" >{{'Used' | translate}}</th>
                          <th class="font-weight-normal width-table text-center" scope="col" >{{'Remain' | translate}}</th>
                          <th class="font-weight-normal width-table text-center" scope="col" >{{selectYear+1}}</th>
                        </tr>
                      <tr class="text-white font-weight-normal">
                          <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}</th>
                          <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}</th>
                          <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}</th>
                          <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}</th>
                          <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}</th>
                        </tr>
                  </thead>
                  <tbody >
                      <tr *ngFor="let item of empLeaveStatistic; let i = index">
                          <td class="align-middle ">{{item.getDesc()}}</td>
                          <td class="align-middle text-center">{{item.eventgrpid== 'VAC'?item.lastYearV1:''}}</td>
                          <td class="align-middle text-center">{{item.limit}}</td>
                          <td class="align-middle text-center">{{item.used}}</td>
                          <td class="align-middle text-center">{{item.remain}}</td>
                          <td class="align-middle text-center">{{item.eventgrpid== 'VAC'?item.nextYearV1:''}}</td>
                      </tr>
                  </tbody>
                </table>

              </ng-template>
            </li>
            <li [ngbNavItem]="2"  *ngIf="!loadEmpLeaveStatistic">
              <a ngbNavLink>{{"graph" | translate}}</a>
              <ng-template ngbNavContent>
                <div class="row">
                  <div class="col-lg-4 col-md-6  col-xs-6 mb-2 text-center"
                    *ngFor="let item of empLeaveStatistic; let i=index">
                    <h4 class="text-white ">
                      <span class="badge bg-info btn-block font-weight-bold">{{item.getDesc()}}</span>
                    </h4>
                    <small class="text-muted">{{"Limit" | translate}}</small>
                    <h6>{{item.limit}}</h6>
                    <small class="text-muted">{{"Used" | translate}}</small>
                    <h6>{{item.used}}</h6>
                    <small class="text-muted">{{"Remain" | translate}}</small>
                    <h6>{{item.remain}}</h6>
                  </div>
                </div>
              </ng-template>
            </li>
          </ul>
          <div [ngbNavOutlet]="navKC" class="mt-2"></div> -->

          <div class="row" *ngIf="!loadEmpLeaveStatistic">
            <div class="col-12">
              <perfect-scrollbar [config]="{useBothWheelAxes: true, suppressScrollX: false, suppressScrollY: false}">
              <table class="table table-bordered table-sm   no-wrap v-middle " id="table">
                <thead class="bg-info ">
                  <tr class="text-white font-weight-normal">
                    <th class="font-weight-normal width-table  align-middle text-center" scope="col" rowspan="2">
                      {{"Leave Type" | translate}}</th>
                    <th class="font-weight-normal width-table text-center" scope="col">{{selectYear-1}}</th>
                    <th class="font-weight-normal width-table text-center" scope="col">{{'menu.employee-leaverole' |
                      translate}}</th>
                    <th class="font-weight-normal width-table text-center" scope="col">{{'Used' | translate}}</th>
                    <th class="font-weight-normal width-table text-center" scope="col">{{'Remain' | translate}}</th>
                    <th class="font-weight-normal width-table text-center" scope="col">{{selectYear+1}}</th>
                  </tr>
                  <tr class="text-white font-weight-normal">
                    <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}
                    </th>
                    <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}
                    </th>
                    <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}
                    </th>
                    <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}
                    </th>
                    <th class="font-weight-normal width-table text-center" scope="col">{{'date-hr-min' | translate}}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of empLeaveStatistic; let i = index">
                    <td class="align-middle ">{{item.getDesc()}}</td>
                    <td class="align-middle text-center">{{item.eventgrpid== 'VAC'?item.lastYearV1:''}}</td>
                    <td class="align-middle text-center">{{item.limit}}</td>
                    <td class="align-middle text-center">{{item.used}}</td>
                    <td class="align-middle text-center">{{item.remain}}</td>
                    <td class="align-middle text-center">{{item.eventgrpid== 'VAC'?item.nextYearV1:''}}</td>
                  </tr>
                </tbody>
              </table>
            </perfect-scrollbar>
            </div>
          </div>

        </div>
      </div>
    </div>
    <div class="card-body ">
      <div class="d-flex no-block align-items-center justify-content-center">
        <div class="action-form">
          <div class="form-group m-b-0 text-center">
            <button [disabled]="loadEmpLeaveStatistic" type="submit" class="btn btn-success waves-effect waves-light"
              (click)="openOnSubmit()"><i class=" fas fa-check"></i>
              {{"Submit" | translate}}</button>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Row ปิดใบขอลาหยุดงาน -->

<ng-template #DocReferenceModal let-modal>
  <div class="modal-content dialog-height">
    <div class="modal-header">
      <h5 class="modal-title" id="editLabel">{{"systemcode.documents.detail" | translate}}</h5>
      <button type="button" class="close" (click)="closeBtnClick()" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body" [perfectScrollbar]="config">
      <div class="card" style="margin-bottom:-15px">
        <div class="card-body">
          <!-- ใส่เอกสารตรงนี้นะจ๊ะ -->
          <ng-template #workflowView [ngComponentOutlet]="dynamicComponent" [ndcDynamicInputs]="inputs"
            [ndcDynamicOutputs]="outputs"></ng-template>
          <!-- <app-wel210-nstda-create></app-wel210-nstda-create> -->
        </div>
      </div>
      <div class="d-flex no-block align-items-center justify-content-center mt-4">
        <div class="action-form">
          <div class="form-group m-b-0 text-center">
            <button type="button" class="btn btn-danger" (click)="onCancel()"><i class=" fas fa-times"></i>
              {{"cancel" |translate}}</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-info" (click)="closeBtnClick()">{{"confirm"| translate}}</button>
    </div>
  </div>
</ng-template>
