<div class="row">
    <!-- ส่งถึง -->
    <div class="col-12">
        <div class="col-12">
          <app-workflow-sendto (employeeCCId)="employeeCCId=$event" [wfid]="wfid" [cardName]="'Request Shift Change Form By Supervisor'"></app-workflow-sendto>
    </div>
    </div>
    <!-- รายละเอียดข้อมูลพนักงาน -->
    <div class="col-12">
        <div class="card mb-0">
            <div class="card-header bg-myhr">
                <h6 class="card-title">{{"Employee Detail" | translate}}</h6>
            </div>
            <div class="card-body" *ngIf="employeeSelect">
                <div class="row">
                    <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"Employee ID" | translate}}</small>
                        <h6>
                            <button type="button" class="btn btn-info  btn-sm btn-circle me-3"
                            (click)="openModal(empSup, 'empSup')"><i class="fa fa-search"></i>
                            </button>
                            {{employeeSelect.employeeId}}
                        </h6>
                    </div>
                    <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"Name-Surname" | translate}}</small>
                        <h6>{{checkEmptyText(employeeSelect.getFullname())}}</h6>
                      </div>
                      <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"Position" | translate}}</small>
                        <h6>{{checkEmptyText(employeeSelect.position?.getPositionDesc())}}</h6>
                      </div>
                      <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"dashboard.bu1" | translate}}</small>
                        <h6>{{checkEmptyText(employeeSelect.bu1?.getBu1Desc())}}</h6>
                      </div>
                      <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"dashboard.bu2" | translate}}</small>
                        <h6>{{checkEmptyText(employeeSelect.bu2?.getBu2Desc())}}</h6>
                      </div>
                      <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"dashboard.bu3" | translate}}</small>
                        <h6>{{checkEmptyText(employeeSelect.bu3?.getBu3Desc())}}</h6>
                      </div>
                      <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"dashboard.bu4" | translate}}</small>
                        <h6>{{checkEmptyText(employeeSelect.bu4?.getBu4Desc())}}</h6>
                      </div>
                      <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"dashboard.bu5" | translate}}</small>
                        <h6>{{checkEmptyText(employeeSelect.bu5?.getBu5Desc())}}</h6>
                      </div>
                      <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"dashboard.bu6" | translate}}</small>
                        <h6>{{employeeSelect.bu6?employeeSelect.bu6.getBu6Desc():"-"}}</h6>
                      </div>
                      <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"dashboard.bu7" | translate}}</small>
                        <h6>{{employeeSelect.bu7?employeeSelect.bu7.getBu7Desc():"-"}}</h6>
                      </div>
                    <div class="col-md-6 col-xs-12 b-r">
                        <small class="text-muted">{{"tel" | translate}}</small>
                        <h6>{{employeeSelect.telExt?employeeSelect.telExt:"-"}}</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- รายละเอียดการเปลี่ยนกะ -->
    <div class="col-12">
        <div class="card mb-0">
            <div class="card-header bg-myhr">
                <h6 class="card-title">{{"swap-shift-detail" | translate }}</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 col-xs-12 b-r">
                        <div class="form-group">
                            <small class="text-muted">{{"start.date"| translate }}</small>
                            <div class="input-group">
                                <input class="form-control col-md-6 col-sm-6 col-lg-6"
                                    placeholder="{{'dd.mm.yyyy' | translate}}" name="dp1" [(ngModel)]="startDate"
                                    ngbDatepicker #d1="ngbDatepicker"
                                    (ngModelChange)=" updateShiftByStartDate()"
                                    #c1="ngModel" (change)="startDate = datepickerService.validateFormatDate(c1);dateChange();"
                                    (dateSelect)="dateChange()" 
                                    >
                                <div class="input-group-append">
                                    <button class="btn btn-outline-info no-shadow" (click)="d1.toggle()" type="button">
                                        <i class="far fa-calendar-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-xs-12 b-r">
                        <div class="form-group">
                            <small class="text-muted">{{"end.date"| translate }}</small>
                            <div class="input-group">
                                <input class="form-control col-md-6 col-sm-6 col-lg-6"
                                    placeholder="{{'dd.mm.yyyy' | translate}}" name="dp2" [(ngModel)]="endDate"
                                    ngbDatepicker #d2="ngbDatepicker"
                                    #c2="ngModel" (change)="endDate = datepickerService.validateFormatDate(c2);dateChange();"
                                    (blur)="dateChange()" (dateSelect)="dateChange()"
                                    >
                                <div class="input-group-append">
                                    <button class="btn btn-outline-info no-shadow" (click)="d2.toggle()" type="button">
                                        <i class="far fa-calendar-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-xs-12 b-r">
                        <small class="text-muted">{{"main-shift"| translate }}</small>
                        <div class="row">
                            <div class="col-md-2  col-lg-2 col-sm-2">
                                <div class="form-group">
                                    <input readonly type="text" class="form-control"
                                    [value]="old_shift">
                                </div>
                            </div>
                            <div class="col-md-4  col-lg-4 col-sm-4">
                                <div class="form-group">
                                    <input readonly type="text" class="form-control"
                                    placeholder="{{translateService.currentLang=='th'?time0descOld.tdesc:time0descOld.edesc}}"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-xs-12 b-r">
                        <small class="text-muted">{{"new-shift"| translate }}</small>
                        <div class="row">
                            <div class="col-md-2 col-lg-2 col-sm-2">
                                <div class="form-group">
                                    <input type="text" class="form-control" [(ngModel)]="shiftSelect.time0id"
                                        (ngModelChange)="shiftIdChange()">
                                </div>
                            </div>
                            <div class="col-md-4 col-lg-4 col-sm-4">
                                <div class="form-group">
                                    <input readonly type="text" class="form-control" value="{{shiftSelect.getDesc!()}}">
                                </div>
                            </div>
                            <div class="col-md-2 col-lg-2 col-sm-2">
                                <div class="form-group">
                                    <button type="submit" class="btn btn-info waves-effect waves-light"
                                    (click)="openModal(shiftListModal, 'shiftListModal')"><i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- เหตุผลที่เปลี่ยนกะ -->
    <div class="col-12">
        <div class="card mb-0">
            <div class="card-header bg-myhr">
                <h6 class="card-title">{{"swap-reason" | translate}}</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12 col-xs-12 b-r">
                        <div class="form-group">
                            <small class="text-muted">{{"swap-reason"| translate}}</small>
                            <textarea class="form-control" rows="2" style="resize: none;" [(ngModel)]="reason"
                                placeholder='{{"swap-reason"| translate}}'></textarea>
                        </div>
                    </div>
                    <app-workflow-remark [wfid]="wfid"></app-workflow-remark>
                    <div class="col-md-12 col-xs-12 b-r">
                        <small class="text-muted">{{"Note" | translate}}</small>
                        <h6>{{"systemcode.shiftchange.1" | translate}}</h6>
                        <h6>{{"systemcode.shiftchange.2" | translate}}</h6>
                        <button
                            [disabled]="!shiftSelect.tdesc&&!shiftSelect.edesc||!checkDateFormat(startDate)||!checkDateFormat(endDate)"
                            type="submit" class="btn btn-info waves-effect waves-light me-1"
                            (click)="getShiftListTime()">View</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ตารางเรียกดูข้อมูล -->
    <div class="col-12" *ngIf="view">
        <div class="card mb-0 ">
            <div class="card-header bg-myhr">
                <h6 class="card-title">{{ "Exchange Shift Data" | translate }}</h6>
            </div>
            <div class="card-body pe-0 ps-0 pb-0 mb-2">
                <h6 class="ms-4">{{"systemcode.old.work"|translate}}</h6>
                <div class="table-responsive">
                    <div class="wrapper">
                        <table class="table  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
                            <thead class="bg-info ">
                                <tr class="text-white font-weight-normal">
                                    <th class="font-weight-normal text-center" scope="col">{{"day" | translate }}</th>
                                    <th class="font-weight-normal text-center" scope="col">{{"Shift ID" | translate }}
                                    </th>
                                    <th class="font-weight-normal text-center" scope="col">{{"detail" | translate }}
                                    </th>
                                    <th class="font-weight-normal text-center" scope="col">{{"Time In" | translate }}
                                    </th>
                                    <th class="font-weight-normal text-center" scope="col">{{"Time Out" | translate }}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- จุดปรับ view -->
                                <tr *ngFor="let item of shiftListTimeOld; let i=index">
                                    <td class="align-middle text-center">{{item.startDate}}</td>
                                    <td class="align-middle text-center">{{item.timeCode}}</td>
                                    <td class="align-middle text-center">{{item.timeCodeTdesc}}</td>
                                    <td class="align-middle text-center">{{item.startTime|number:"2.2"}}</td>
                                    <td class="align-middle text-center">{{item.endTime|number:"2.2"}}</td>
                                </tr>
                                <tr>
                                    <td  class="align-middle text-center">{{"all" | translate }} :
                                        {{shiftListTimeOld.length}}
                                        {{"day" | translate}}
                                    </td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="card-body pe-0 ps-0 pb-0 mb-2">
                <h6 class="ms-4">{{"systemcode.new.work"|translate}}</h6>
                <div class="table-responsive">
                    <div class="wrapper">
                        <table class="table  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
                            <thead class="bg-info ">
                                <tr class="text-white font-weight-normal">
                                    <th class="font-weight-normal text-center" scope="col">{{"day" | translate }}</th>
                                    <th class="font-weight-normal text-center" scope="col">{{"Shift ID" | translate }}
                                    </th>
                                    <th class="font-weight-normal text-center" scope="col">{{"detail" | translate }}
                                    </th>
                                    <th class="font-weight-normal text-center" scope="col">{{"Time In" | translate }}
                                    </th>
                                    <th class="font-weight-normal text-center" scope="col">{{"Time Out" | translate }}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of shiftListTimeNew; let i=index">
                                    <td class="align-middle text-center">{{item.startDate}}</td>
                                    <td class="align-middle text-center">{{item.timeCode}}</td>
                                    <td class="align-middle text-center">{{item.getDesc()}}</td>
                                    <td class="align-middle text-center">{{item.startTime|number:"2.2"}}</td>
                                    <td class="align-middle text-center">{{item.endTime|number:"2.2"}}</td>
                                </tr>
                                <tr>
                                    <td class="align-middle text-center">{{"all" | translate }} :
                                        {{shiftListTimeNew.length}}
                                        {{"day" | translate}}
                                    </td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- เหตุผล -->
    <div class="col-12">
        <div class="card mb-0">
            <div class="card-header bg-myhr">
                <h6 class="card-title">{{"systemcode.note" | translate}}</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12 col-xs-12 b-r">
                        <div class="form-group">
                            <small class="text-muted">{{"systemcode.note"| translate}}</small>
                            <textarea class="form-control" rows="2" style="resize: none;" [(ngModel)]="remark"
                                placeholder='{{"systemcode.note"| translate}}'></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- เอกสารอ้างอิง -->
    <div class="col-12" *ngIf="runno&&workflowData">
        <div class="card mb-0">
            <div class="card-header bg-myhr">
                <h6 class="card-title">{{"Doc Reference" | translate}}</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 col-xs-12 b-r">
                        <div class="form-group">
                            <h6 class="cursor-myhr" class="cursor-myhr" (click)="openDocReference()">
                                {{"Exchange Shift Requisition Form Center" | translate}}
                                {{translateService.currentLang=="th"?workflowData.thaiSubject:workflowData.engSubject}}
                                [{{workflowData.doc_no}}]
                            </h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- แนบไฟล์ -->
    <div class="col-12">
        <div class="card mb-0">
            <div class="card-header bg-myhr">
                <h6 class="card-title">{{"attach_file" | translate}}</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 col-xs-12 b-r">
                        <div class="form-group">
                            <small class="text-muted">{{"selected_file"| translate}}</small>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">{{"upload_file"|translate}}</span>
                                </div>
                                <div class="custom-file">
                                    <input #fileInput type="file" class="custom-file-input" id="inputGroupFile01"
                                        title="" (change)="onFileSelected($event)"
                                        accept="{{uploadConfig?uploadConfig.filter.replaceAll('*',''):''}}">
                                    <label class="custom-file-label col-lg-12 col-md-12 col-sm-12"
                                        for="inputGroupFile01">{{nameFile |
                                        translate}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-xs-12 b-r">
                        <div class="form-group " style="margin-top: 20px;">
                            <button type="button" class="btn btn-danger" (click)="resetIMG()">{{"cancel"|
                                translate}}</button>
                        </div>
                    </div>
                    <div class="col-md-12 col-xs-12 b-r" *ngIf="uploadConfig">
                        <p class="text-danger m-b-0">{{"Maximum upload size" | translate}}
                            {{uploadConfig.maxSize/1024/1024}} MB</p>
                        <p class="text-danger">{{"Extensions are support" | translate}} {{uploadConfig.filter}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body ">
        <div class="d-flex no-block align-items-center justify-content-center">
            <div class="action-form">
                <div class="form-group m-b-0 text-center">
                    <button
                        [disabled]="!shiftSelect.tdesc&&!shiftSelect.edesc||!checkDateFormat(startDate)||!checkDateFormat(endDate)"
                        type="submit" class="btn btn-success waves-effect waves-light" (click)="onSubmit()">
                        <i class=" fas fa-check"></i> {{"Submit" | translate}}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- เพิ่มพนักงาน -->
<ng-template #empSup let-modal>
    <div class="modal-content dialog-height">
        <div class="modal-body" [perfectScrollbar]="config">
            <div class="card" style="margin-bottom:-15px">
                <div class="card-header bg-myhr">
                    <h4>{{"menu.employee-list" | translate}}</h4>
                </div>
                <div class="card-body pt-0 pt-2">
                    <div class="d-flex mb-1">
                        <input type="text" placeholder="{{'Name-Surname' | translate}}, {{'Employee ID' | translate}}, {{'Position' | translate}} {{'and_all_bu' | translate}}" class="form-control"  style="width: 375px;" 
                            [(ngModel)]="employeeSearch" (ngModelChange)="searchDataEmp()">
                    </div>
                    <div class="table-responsive">
                        <table class="table  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
                            <thead class="bg-info ">
                                <tr class="text-white font-weight-normal">
                                    <th class="font-weight-normal" scope="col">{{"No."| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Employee ID"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Name-Surname"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Position"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Bu1"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Bu2"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Bu3"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Bu4"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Bu5"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Bu6"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"Bu7"| translate}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngIf="!empFilter">
                                    <td colspan="9" class="font-weight-normal text-center">
                                        {{"No Data Found" | translate}}
                                    </td>
                                </tr>
                                <tr class="cursor-myhr"
                                    *ngFor="let item of empFilter |slice: (pageEmp-1) * pageSizeEmp : (pageEmp-1) * pageSizeEmp + pageSizeEmp ; let i=index"
                                    (click)="selectEmployee(item);modal.close()">
                                    <th class="align-middle text-center" scope="row">
                                        {{(i+1)+((pageEmp-1) * pageSizeEmp)}}
                                    </th>
                                    <td class="align-middle">{{ item.employeeId}}</td>
                                    <td class="align-middle">{{ item.getFullname()?item.getFullname():'-'}}</td>
                                    <td class="align-middle">{{
                                        item.position.getPositionDesc()?item.position.getPositionDesc():'-'}}
                                    </td>
                                    <td class="align-middle">{{ item.bu1?.getBu1Desc()?item.bu1?.getBu1Desc():'-'}}</td>
                                    <td class="align-middle">{{ item.bu2?.getBu2Desc()?item.bu2?.getBu2Desc():'-'}}</td>
                                    <td class="align-middle">{{ item.bu3?.getBu3Desc()?item.bu3?.getBu3Desc():'-'}}</td>
                                    <td class="align-middle">{{ item.bu4?.getBu4Desc()?item.bu4?.getBu4Desc():'-'}}</td>
                                    <td class="align-middle">{{ item.bu5?.getBu5Desc()?item.bu5?.getBu5Desc():'-'}}</td>
                                    <td class="align-middle">{{ item.bu6?.getBu6Desc()?item.bu6?.getBu6Desc():'-'}}</td>
                                    <td class="align-middle">{{ item.bu7?.getBu7Desc()?item.bu7?.getBu7Desc():'-'}}</td>
                                    <!-- <td class="align-middle">{{ item.bu6?.getBu6Desc() || '-' }}</td>
                                    <td class="align-middle">{{ item.bu7?.getBu7Desc() || '-' }}</td> -->
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-end p-2">
                        <select class="form-select m-r-5" style="width: auto" [(ngModel)]="pageSizeEmp"
                            (ngModelChange)="pageEmp=1">
                            <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
                            <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
                            <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
                        </select>
                        <ngb-pagination [collectionSize]="empFilter.length" [(page)]="pageEmp" [pageSize]="pageSizeEmp"
                            [maxSize]="3" [rotate]="true">
                            <ng-template ngbPaginationPrevious>{{"Prev" | translate}}</ng-template>
                            <ng-template ngbPaginationNext>{{"Next" | translate}}</ng-template>
                        </ngb-pagination>
                    </div>
                </div>
            </div>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
                {{"Close"| translate}}
            </button>
        </div>
    </div>
</ng-template>

<ng-template #shiftListModal let-modal>
    <div class="modal-content dialog-height">
        <div class="modal-body"  >
            <div class="card" style="margin-bottom:-15px">
                <div class="card-header bg-myhr">
                    <h4>{{"working-table" | translate}}</h4>
                </div>
                <div class="card-body pt-0 pt-2">
                    <div class="d-flex mb-1">
                        <input type="text" placeholder="{{'time-code' | translate}}" class="form-control w-25"
                            [(ngModel)]="shiftSearch" (ngModelChange)="searchDataShift()">
                    </div>
                    <div class="table-responsive">
                        <table class="table  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
                            <thead class="bg-info ">
                                <tr class="text-white font-weight-normal">
                                    <th class="font-weight-normal" scope="col">{{"time-code"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"th-detail"| translate}}</th>
                                    <th class="font-weight-normal" scope="col">{{"en-detail"| translate}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngIf="!shiftFilter">
                                    <td colspan="4" class="font-weight-normal text-center">{{"No Data Found" |
                                        translate}}</td>
                                </tr>
                                <tr class="cursor-myhr"
                                    *ngFor="let item of shiftFilter |slice: (pageShift-1) * pageSizeShift : (pageShift-1) * pageSizeShift + pageSizeShift; let i=index"
                                    (click)="selectShift(item);modal.close()">
                                    <td class="align-middle">{{item.time0id}}</td>
                                    <td class="align-middle">{{item.tdesc}}</td>
                                    <td class="align-middle">{{item.edesc}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-end p-2">
                        <select class="form-select m-r-5" style="width: auto" [(ngModel)]="pageSizeShift"
                            (ngModelChange)="pageShift=1">
                            <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
                            <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
                            <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
                        </select>
                        <ngb-pagination [collectionSize]="shiftFilter.length" [(page)]="pageShift"
                            [pageSize]="pageSizeShift" [maxSize]="3" [rotate]="true">
                            <ng-template ngbPaginationPrevious>{{"Prev" | translate}}</ng-template>
                            <ng-template ngbPaginationNext>{{"Next" | translate}}</ng-template>
                        </ngb-pagination>
                    </div>
                </div>
            </div>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
                {{"Close"| translate}}
            </button>
        </div>
    </div>
</ng-template>
