<!--
  Modern Outbox/Sentbox Layout
  - Reuses the same responsive 2-pane structure as the Inbox for consistency.
  - Simplified toolbar (Search and Create New).
  - List items are not selectable.
-->
<div class="inbox-container">

  <!-- Toolbar: Search and Actions -->
  <div class="inbox-toolbar">
    <div class="search-input-container input-group">
      <span class="input-group-text bg-transparent border-0"><i class="mdi mdi-magnify"></i></span>
      <input
        type="text"
        class="form-control border-0 bg-transparent"
        placeholder="{{ 'systemcode.search' | translate }} {{ 'Doc No.' | translate }}, {{ 'subject' | translate }}, {{ 'receiver' | translate }}"
        [ngModel]="docNo"
        (ngModelChange)="changeDocNo($event); scrollToTop('workflowDataList')"
      />
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons ms-auto">
      <button type="button" class="btn btn-success" (click)="openCreateDocModal()">
        <i class="mdi mdi-plus me-1"></i>
        {{ "menu.myhr-create-doc" | translate }}
      </button>
    </div>
  </div>

  <!-- Loading Overlay -->
  @if (workflowListLoading) {
    <div class="loading-container">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  }

  <!-- Main Content: List and Detail Panes -->
  <div class="inbox-main-content">
    <!-- Left Pane: Workflow List -->
    <div class="inbox-list-pane" [class.detail-visible]="workflow && !windowWidth(768)">
      <div class="list-pane-header">
        <span class="list-count ms-auto">{{ 'all' | translate }} {{ workflowList.length }} {{ 'Note(s)' | translate }}</span>
      </div>

      <div #workflowDataList class="list-pane-body">
        @if (workflowList.length > 0) {
          @for (item of workflowList | slice:(page-1) * pageSize : (page-1) * pageSize + pageSize; track item.wf_id) {
            <div
              class="workflow-item"
              [class.active]="workflow?.wf_id === item.wf_id"
              (click)="openWorkflowDetail(item)">
              <div class="item-avatar">
                <!-- In Outbox, the initiator is the current user, so we show the receiver's picture if available -->
                <img appShowLoading src="{{ jbossUrl + '/FileViewer.jsp?uploadfield=memployee.picture&filename=' + item.receiver_pic }}" alt="user" />
              </div>
              <div class="item-content">
                <div class="content-header">
                  <!-- Show receiver's name -->
                  <span class="sender-name" title="{{ item.getReceiverDesc() }}">{{ item.getReceiverDesc() }}</span>
                  <span class="timestamp" [ngbTooltip]="(convertDate(item.date) | thaidate:'fullNotYear') + ' ' + convertTime(item.date)" container="body">
                    {{ (convertDate(item.date) | date:'EE') | translate }} {{ convertTime(item.date) }}
                  </span>
                </div>
                <div class="content-subject" title="{{ item.getSubjectDesc() }}">
                  {{ item.getSubjectDesc() }}
                </div>
                <div class="content-footer">
                  <span class="doc-no">{{ item.docNo }}</span>
                  <div class="status-icon" [ngbTooltip]="getWorkflowStatusInfo(item).tooltip | translate" container="body">
                     <i class="mdi" [ngClass]="getWorkflowStatusInfo(item).icon" [style.color]="getWorkflowStatusInfo(item).color"></i>
                  </div>
                </div>
              </div>
            </div>
          }
        } @else if (!workflowListLoading) {
          <div class="empty-list-message">
            <i class="mdi mdi-email-arrow-up-outline"></i>
            <h5>{{ 'No Sent Items' | translate }}</h5>
            <p>{{ 'You have not sent any documents yet.' | translate }}</p>
          </div>
        }
      </div>

      @if (workflowList.length > pageSize) {
        <div class="list-pane-footer">
          <ngb-pagination
            [collectionSize]="workflowList.length"
            [(page)]="page"
            [pageSize]="pageSize"
            [maxSize]="5"
            [rotate]="true"
            [ellipses]="false"
            (pageChange)="scrollToTop('workflowDataList')">
          </ngb-pagination>
        </div>
      }
    </div>

    <!-- Right Pane: Workflow Detail -->
    <div class="inbox-detail-pane" [class.visible]="workflow && !windowWidth(768)">
      @if (workflow) {
        <div class="detail-content-wrapper">
          <div class="detail-header">
            <button class="btn btn-icon btn-light-secondary back-button" (click)="workflow = undefined">
              <i class="mdi mdi-arrow-left"></i>
            </button>
            <h4 class="detail-subject" title="{{ workflow.getSubjectDesc() }}">{{ workflow.getSubjectDesc() }}</h4>
            <div class="status-icon" [ngbTooltip]="getWorkflowStatusInfo(workflow).tooltip | translate" container="body">
                <i class="mdi" [ngClass]="getWorkflowStatusInfo(workflow).icon" [style.color]="getWorkflowStatusInfo(workflow).color"></i>
            </div>
          </div>
          <div #workflowDataShow class="detail-body">
            <app-workflow-type
              [workflow]="workflow"
              [fromPage]="'outbox'"
              (newLoading)="firstGetSentbox()">
            </app-workflow-type>
          </div>
        </div>
      } @else {
        <div class="placeholder">
          <i class="mdi mdi-email-outline"></i>
          <h5>{{ 'systemcode.select.workflow' | translate }}</h5>
          <p>{{ 'Select an item from the list to see the details.' | translate }}</p>
        </div>
      }
    </div>
  </div>
</div>

<!-- Modal for 'Zeeme' integration -->
<ng-template #openModalWorkflow let-modal>
  <div class="modal-header bg-myhr">
    <h5 class="modal-title text-white">{{ workflow?.getSubjectDesc() }}</h5>
    <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss('Cross click')" aria-label="Close"></button>
  </div>
  <div class="modal-body p-0">
    @if (workflow) {
      <app-workflow-type
        [workflow]="workflow"
        [fromPage]="'outbox'"
        (newLoading)="firstGetSentbox()">
      </app-workflow-type>
    }
  </div>
</ng-template>
