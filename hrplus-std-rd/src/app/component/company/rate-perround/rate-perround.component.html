<div class="modern-card rate-perround-card">
    <div class="card-header">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <div class="card-title-section">
                <h4 class="card-title">
                    <span class="material-symbols-outlined me-2">payments</span>
                    {{ "Rate Perround" | translate }}
                </h4>
                <p class="card-subtitle text-muted mb-0">{{ "Manage rate perround configurations" | translate }}</p>
            </div>
            <div class="card-actions">
                <button type="button" class="btn btn-outline-secondary btn-icon" (click)="refreshData()"
                    [attr.aria-label]="'Refresh' | translate"
                    [title]="'Refresh' | translate">
                    <span class="material-symbols-outlined">refresh</span>
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <!-- Rate ID -->
        <div class="row align-items-center mb-3">
            <div class="col-12 col-md-3 fw-bold text-md-end form-label">
                {{ "RATE ID" | translate }}
            </div>
            <div class="col-12 col-md-3 mt-2 mt-md-0">
                <div class="input-group">
                    <input type="text" maxlength="3" class="form-control" placeholder="{{'RATE ID' | translate}}"
                        [(ngModel)]="mrate.rateId" (ngModelChange)="findMrate('rateId',$event)">
                    <button class="btn btn-primary" type="button" (click)="openRateModal(rateModal)"
                        [attr.aria-label]="'Search' | translate"
                        [title]="'Search' | translate">
                        <span class="material-symbols-outlined">search</span>
                    </button>
                </div>
            </div>
            <div class="col-12 col-md-3 mt-2 mt-md-0 text-center text-md-start">
                <button type="button" class="btn btn-danger btn-sm"
                    [disabled]="mrate.rateId==''" (click)="deleteMrate()"
                    [attr.aria-label]="'Delete' | translate"
                    [title]="'Delete' | translate">
                    <span class="material-symbols-outlined me-1">delete</span>
                    {{"Rate Perround:Delete" | translate}}
                </button>
            </div>
        </div>
        <div class="row align-items-center mb-3">
            <div class="col-12 col-md-3 fw-bold text-md-end form-label">
                {{"Effective Date" | translate}}
            </div>
            <div class="col-12 col-md-3 mt-2 mt-md-0">
                <div class="input-group">
                    <input class="form-control" placeholder="{{'dd.mm.yyyy' | translate}}" name="dp1" ngbDatepicker
                        #d1="ngbDatepicker" [(ngModel)]="effDate" (ngModelChange)="findMrate('effDate',$event)"
                        [ngClass]="{'border-red':!checkDateFormat(effDate)}" #c1="ngModel"
                        (change)="effDate = datepickerService.validateFormatDateNull(c1)">
                    <button class="btn btn-outline-primary" (click)="d1.toggle()" type="button"
                        [attr.aria-label]="'Select Date' | translate"
                        [title]="'Select Date' | translate">
                        <span class="material-symbols-outlined">calendar_today</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="row align-items-center mb-3">
            <div class="col-12 col-md-3 fw-bold text-md-end form-label">
                {{"Group" | translate}}
            </div>
            <div class="col-12 col-md-3 mt-2 mt-md-0">
                <div class="input-group">
                    <input type="text" maxlength="10" class="form-control" placeholder="{{'Group ID'| translate}}"
                        [(ngModel)]="mrate.groupId" (ngModelChange)="findMrate('groupId',$event);groupIdChange($event)">
                    <button class="btn btn-primary" type="button" (click)="openWorkareaModal(workareaModal)"
                        [attr.aria-label]="'Search' | translate"
                        [title]="'Search' | translate">
                        <span class="material-symbols-outlined">search</span>
                    </button>
                </div>
            </div>
            <div class="col-12 col-md-3 mt-2 mt-md-0">
                <input readonly type="text" class="form-control" placeholder="{{'Group Name'| translate}}"
                    [value]="getName(gworkarea0.tdesc,gworkarea0.edesc)">
            </div>
        </div>
        <div class="row align-items-center mb-3">
            <div class="col-12 col-md-3 fw-bold text-md-end form-label">
                {{"Desc." | translate}}
            </div>
            <div class="col-12 col-md-3 mt-2 mt-md-0">
                <input type="text" class="form-control" placeholder="{{'Desc. (Thai)'| translate}}"
                    [(ngModel)]="mrate.tdesc">
            </div>
            <div class="col-12 col-md-3 mt-2 mt-md-0">
                <input type="text" class="form-control" placeholder="{{'Desc. (Eng.)'| translate}}"
                    [(ngModel)]="mrate.edesc">
            </div>
        </div>
        <div class="row align-items-center mb-3">
            <div class="col-12 col-md-3 fw-bold text-md-end form-label">
                {{"Rate Perround:Type" | translate }}
            </div>
            <div class="col-12 col-md-3 mt-2 mt-md-0">
                <select class="form-control" [ngModel]="mrate.type" (ngModelChange)="mrate.type=$event">
                    <option class="d-none" [value]="''">{{ "Type" | translate }}</option>
                    <option *ngFor="let item of positionGroupList; let i=index" [ngValue]="item.positionGroupId">
                        {{item.getName()}}
                    </option>
                </select>
            </div>
        </div>
        <div class="row">
            <div class="col-12 d-flex mb-2">
                <div class="stats-badge ms-auto">
                    <span class="badge-text">{{'all'| translate}}</span>
                    <span class="badge-count">{{mrate1List.length}}</span>
                </div>
            </div>
            <div class="table-responsive d-none d-lg-block">
                <table class="table modern-table">
                    <thead>
                        <tr>
                            <th class="col-checkbox">
                                <input type="checkbox" [ngModel]="checkboxAll" (ngModelChange)="selectAll($event)"
                                    [attr.aria-label]="'Select All' | translate"
                                    [title]="'Select All' | translate"
                                    [attr.id]="'selectAllCheckbox'"
                                    [attr.name]="'selectAllCheckbox'"
                                    placeholder="Select All">
                            </th>
                            <th>{{"Fuel Fee" | translate}}</th>
                            <th>{{"Distance less than 10 KM" | translate}}</th>
                            <th>{{"Distance 10 to 20 KM" | translate}}</th>
                            <th>{{"Distance is over 20 KM" | translate}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngIf="mrate1List.length==0">
                            <td colspan="100" class="text-center">{{"No Data Found" | translate}}</td>
                        </tr>
                        <tr *ngFor="let item of mrate1List | slice:(page-1)*pageSize : (page-1)*pageSize+pageSize;">
                            <td class="text-center">
                                <input type="checkbox" [(ngModel)]="item.checkbox"
                                    [attr.aria-label]="'Select item' | translate"
                                    [title]="'Select item' | translate"
                                    [attr.id]="'selectItem_' + item.data.lineNo"
                                    [attr.name]="'selectItem_' + item.data.lineNo"
                                    placeholder="Select item">
                            </td>
                            <td class="text-center">
                                <div class="d-flex justify-content-center align-items-center gap-2">
                                    <input type="text" class="form-control" [(ngModel)]="item.data.rstart"
                                        [attr.aria-label]="'Start value' | translate"
                                        [title]="'Start value' | translate"
                                        [attr.id]="'rstart_' + item.data.lineNo"
                                        [attr.name]="'rstart_' + item.data.lineNo"
                                        placeholder="Start">
                                    <span>-</span>
                                    <input type="text" class="form-control" [(ngModel)]="item.data.rend"
                                        [attr.aria-label]="'End value' | translate"
                                        [title]="'End value' | translate"
                                        [attr.id]="'rend_' + item.data.lineNo"
                                        [attr.name]="'rend_' + item.data.lineNo"
                                        placeholder="End">
                                </div>
                            </td>
                            <td class="text-center">
                                <input type="text" class="form-control"
                                    [(ngModel)]="item.data.distanceLessThan10km"
                                    [attr.aria-label]="'Distance less than 10 KM' | translate"
                                    [title]="'Distance less than 10 KM' | translate"
                                    [attr.id]="'distanceLessThan10km_' + item.data.lineNo"
                                    [attr.name]="'distanceLessThan10km_' + item.data.lineNo"
                                    placeholder="< 10 KM">
                            </td>
                            <td class="text-center">
                                <input type="text" class="form-control"
                                    [(ngModel)]="item.data.distance10Point1To20km"
                                    [attr.aria-label]="'Distance 10 to 20 KM' | translate"
                                    [title]="'Distance 10 to 20 KM' | translate"
                                    [attr.id]="'distance10Point1To20km_' + item.data.lineNo"
                                    [attr.name]="'distance10Point1To20km_' + item.data.lineNo"
                                    placeholder="10-20 KM">
                            </td>
                            <td class="text-center">
                                <input type="text" class="form-control"
                                    [(ngModel)]="item.data.distanceMoreThan20km"
                                    [attr.aria-label]="'Distance is over 20 KM' | translate"
                                    [title]="'Distance is over 20 KM' | translate"
                                    [attr.id]="'distanceMoreThan20km_' + item.data.lineNo"
                                    [attr.name]="'distanceMoreThan20km_' + item.data.lineNo"
                                    placeholder="> 20 KM">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- Mobile Card View -->
            <div class="d-lg-none mt-3">
                <div *ngIf="mrate1List.length==0" class="empty-state">
                    <div class="empty-icon">ğŸ“Š</div>
                    <p>{{"No Data Found" | translate}}</p>
                </div>
                <div *ngFor="let item of mrate1List | slice:(page-1)*pageSize : (page-1)*pageSize+pageSize;"
                    class="rate-perround-card-mobile">
                    <div class="card-body">
                        <div class="info-row mb-2">
                            <div class="info-item">
                                <span>{{"Fuel Fee" | translate}}</span>
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control" [(ngModel)]="item.data.rstart"
                                        [attr.aria-label]="'Start value' | translate"
                                        [attr.id]="'mobile_rstart_' + item.data.lineNo"
                                        [attr.name]="'mobile_rstart_' + item.data.lineNo"
                                        placeholder="Start">
                                    <span>-</span>
                                    <input type="text" class="form-control" [(ngModel)]="item.data.rend"
                                        [attr.aria-label]="'End value' | translate"
                                        [attr.id]="'mobile_rend_' + item.data.lineNo"
                                        [attr.name]="'mobile_rend_' + item.data.lineNo"
                                        placeholder="End">
                                </div>
                            </div>
                            <div class="info-item">
                                <span>{{"Distance less than 10 KM" | translate}}</span>
                                <input type="text" class="form-control" [(ngModel)]="item.data.distanceLessThan10km"
                                    [attr.aria-label]="'Distance less than 10 KM' | translate"
                                    [attr.id]="'mobile_distanceLessThan10km_' + item.data.lineNo"
                                    [attr.name]="'mobile_distanceLessThan10km_' + item.data.lineNo"
                                    placeholder="< 10 KM">
                            </div>
                            <div class="info-item">
                                <span>{{"Distance 10 to 20 KM" | translate}}</span>
                                <input type="text" class="form-control" [(ngModel)]="item.data.distance10Point1To20km"
                                    [attr.aria-label]="'Distance 10 to 20 KM' | translate"
                                    [attr.id]="'mobile_distance10Point1To20km_' + item.data.lineNo"
                                    [attr.name]="'mobile_distance10Point1To20km_' + item.data.lineNo"
                                    placeholder="10-20 KM">
                            </div>
                            <div class="info-item">
                                <span>{{"Distance is over 20 KM" | translate}}</span>
                                <input type="text" class="form-control" [(ngModel)]="item.data.distanceMoreThan20km"
                                    [attr.aria-label]="'Distance is over 20 KM' | translate"
                                    [attr.id]="'mobile_distanceMoreThan20km_' + item.data.lineNo"
                                    [attr.name]="'mobile_distanceMoreThan20km_' + item.data.lineNo"
                                    placeholder="> 20 KM">
                            </div>
                        </div>
                        <div class="d-flex justify-content-end">
                            <input type="checkbox" [(ngModel)]="item.checkbox"
                                [attr.aria-label]="'Select item' | translate"
                                [title]="'Select item' | translate"
                                [attr.id]="'mobile_selectItem_' + item.data.lineNo"
                                [attr.name]="'mobile_selectItem_' + item.data.lineNo"
                                placeholder="Select item">
                        </div>
                    </div>
                </div>
            </div>
            <div class="pagination-controls d-flex justify-content-end p-2">
                <select class="form-select me-2 mb-2 mb-md-0" [(ngModel)]="pageSize"
                    (ngModelChange)="page=1"
                    [attr.aria-label]="'Items per page' | translate"
                    [title]="'Items per page' | translate">
                    <option [ngValue]="10">{{"Items per page"| translate}}: 10</option>
                    <option [ngValue]="50">{{"Items per page"| translate}}: 50</option>
                    <option [ngValue]="100">{{"Items per page"| translate}}: 100</option>
                </select>
                <ngb-pagination [collectionSize]="mrate1List.length" [(page)]="page" [pageSize]="pageSize" [maxSize]="3"
                    [rotate]="true">
                    <ng-template ngbPaginationPrevious><span class="material-symbols-outlined">chevron_left</span></ng-template>
                    <ng-template ngbPaginationNext><span class="material-symbols-outlined">chevron_right</span></ng-template>
                </ngb-pagination>
            </div>
        </div>
        <div class="row">
            <div class="d-flex flex-wrap gap-2 justify-content-center col-12 mb-3">
                <button type="button" class="btn btn-primary" (click)="addMrate1()"
                    [attr.aria-label]="'Add' | translate"
                    [title]="'Add' | translate">
                    <span class="material-symbols-outlined me-1">add</span>
                    {{"Add"| translate}}
                </button>
                <button type="button" class="btn btn-success" [disabled]="mrate.rateId==''||mrate.groupId==''"
                    (click)="saveMrate()"
                    [attr.aria-label]="'Save' | translate"
                    [title]="'Save' | translate">
                    <span class="material-symbols-outlined me-1">save</span>
                    {{"Save"| translate}}
                </button>
                <button type="button" class="btn btn-danger" (click)="deleteMrate1()"
                    [attr.aria-label]="'Delete' | translate"
                    [title]="'Delete' | translate">
                    <span class="material-symbols-outlined me-1">delete</span>
                    {{"Rate Perround:Delete"| translate}}
                </button>
            </div>
        </div>
    </div>
</div>

<ng-template #rateModal let-modal>
    <div class="modal-body">
        <div class="card modal-card">
            <div class="modal-header">
                <h5 class="modal-title">
                    <span class="material-symbols-outlined me-2">payments</span>
                    {{"Group RATE1" | translate}}
                </h5>
                <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close">
                </button>
            </div>
            <div class="card-body pt-0 pt-2">
                <div class="d-flex col-5 mb-1 p-0 search-container">
                    <input type="text"
                        placeholder="{{'systemcode.search' | translate}} {{'RATE ID' | translate}}{{' / '}}{{'Group ID' | translate}}{{' / '}}{{'Desc.' | translate}}{{' / '}}{{'Rate Perround:Type' | translate}}"
                        class="form-control" [ngModel]="searchModal"
                        (ngModelChange)="modalSearchChange('mrateSearch',$event)">
                </div>
                <div class="table-responsive">
                    <table class="table  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
                        <thead class="bg-primary ">
                            <tr class="text-white font-weight-normal">
                                <th class="font-weight-normal text-center" scope="col">
                                    {{'RATE ID' | translate}}
                                </th>
                                <th class="font-weight-normal text-center" scope="col">
                                    {{"Effective Date"| translate}}
                                </th>
                                <th class="font-weight-normal text-center" scope="col">
                                    {{"Group"| translate}}
                                </th>
                                <th class="font-weight-normal text-center" scope="col">
                                    {{"Desc. (Thai)"| translate}}
                                </th>
                                <th class="font-weight-normal text-center" scope="col">
                                    {{"Desc. (Eng.)"| translate}}
                                </th>
                                <th class="font-weight-normal text-center" scope="col">
                                    {{"Rate Perround:Type"| translate}}
                                </th>
                            </tr>
                        </thead>
                        <tbody *ngIf="mrateListLoading">
                            <tr>
                                <td colSpan="100%" class="text-center">
                                    <div *ngFor="let item of [1,2,3]"
                                        class="spinner-grow text-info m-t-5 m-r-5 m-b-5 m-l-5" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tbody *ngIf="!mrateListLoading&&mrateList.length == 0">
                            <tr>
                                <td colspan="100%" class="font-weight-normal text-center">
                                    {{"No Data Found" | translate}}
                                </td>
                            </tr>
                        </tbody>
                        <tbody *ngIf="!mrateListLoading&&mrateList.length != 0">
                            <tr class="cursor-myhr"
                                *ngFor="let item of mrateList | slice: (pageModal-1) * pageSizeModal : ((pageModal-1) * pageSizeModal) + pageSizeModal; let i=index"
                                (click)="modal.close(item)">
                                <td class="font-weight-normal text-center">
                                    {{item.rateId}}
                                </td>
                                <td class="font-weight-normal text-center">
                                    {{item.effDate | date:"dd-MM-yyyy"}}
                                </td>
                                <td class="font-weight-normal text-center">
                                    {{item.groupId}}
                                </td>
                                <td class="font-weight-normal text-center">
                                    {{item.tdesc}}
                                </td>
                                <td class="font-weight-normal text-center">
                                    {{item.edesc}}
                                </td>
                                <td class="font-weight-normal text-center">
                                    {{item.type}}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-end p-2">
                    <select class="form-select m-r-5 page-size-select" [(ngModel)]="pageSizeModal"
                        (ngModelChange)="pageModal=1">
                        <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
                        <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
                        <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
                    </select>
                    <ngb-pagination [collectionSize]="mrateList.length" [(page)]="pageModal" [pageSize]="pageSizeModal"
                        [maxSize]="3" [rotate]="true">
                        <ng-template ngbPaginationPrevious>{{"Prev" | translate}}</ng-template>
                        <ng-template ngbPaginationNext>{{"Next" | translate}}</ng-template>
                    </ngb-pagination>
                </div>
            </div>
        </div>

    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
            {{"Close"| translate}}
        </button>
    </div>
</ng-template>

<ng-template #workareaModal let-modal>
    <div class="modal-body">
        <div class="card modal-card">
            <div class="modal-header">
                <h5 class="modal-title">
                    <span class="material-symbols-outlined me-2">business</span>
                    {{"Work Area Group" | translate}}
                </h5>
                <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close">
                </button>
            </div>
            <div class="card-body pt-0 pt-2">
                <div class="d-flex col-5 mb-1 p-0 search-container">
                    <input type="text"
                        placeholder="{{'systemcode.search' | translate}} {{'Group ID' | translate}}{{' / '}}{{'Desc.' | translate}}"
                        class="form-control" [ngModel]="searchModal"
                        (ngModelChange)="modalSearchChange('gworkarea0Search',$event)">
                </div>
                <div class="table-responsive">
                    <table class="table  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
                        <thead class="bg-primary ">
                            <tr class="text-white font-weight-normal">
                                <th class="font-weight-normal text-center" scope="col">
                                    {{"Group ID"| translate}}
                                </th>
                                <th class="font-weight-normal text-center" scope="col">
                                    {{"Desc. (Thai)"| translate}}
                                </th>
                                <th class="font-weight-normal text-center" scope="col">
                                    {{"Desc. (Eng.)"| translate}}
                                </th>
                            </tr>
                        </thead>
                        <tbody *ngIf="gworkarea0ListLoading">
                            <tr>
                                <td colSpan="100%" class="text-center">
                                    <div *ngFor="let item of [1,2,3]"
                                        class="spinner-grow text-info m-t-5 m-r-5 m-b-5 m-l-5" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tbody *ngIf="!gworkarea0ListLoading&&gworkarea0List.length == 0">
                            <tr>
                                <td colspan="100%" class="font-weight-normal text-center">
                                    {{"No Data Found" | translate}}
                                </td>
                            </tr>
                        </tbody>
                        <tbody *ngIf="!gworkarea0ListLoading&&gworkarea0List.length != 0">
                            <tr class="cursor-myhr"
                                *ngFor="let item of gworkarea0List | slice: (pageModal-1) * pageSizeModal : ((pageModal-1) * pageSizeModal) + pageSizeModal; let i=index"
                                (click)="modal.close(item)">
                                <td class="font-weight-normal text-center">
                                    {{item.groupId}}
                                </td>
                                <td class="font-weight-normal text-center">
                                    {{item.tdesc}}
                                </td>
                                <td class="font-weight-normal text-center">
                                    {{item.edesc}}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-end p-2">
                    <select class="form-select m-r-5 page-size-select" [(ngModel)]="pageSizeModal"
                        (ngModelChange)="pageModal=1">
                        <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
                        <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
                        <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
                    </select>
                    <ngb-pagination [collectionSize]="gworkarea0List.length" [(page)]="pageModal"
                        [pageSize]="pageSizeModal" [maxSize]="3" [rotate]="true">
                        <ng-template ngbPaginationPrevious>{{"Prev" | translate}}</ng-template>
                        <ng-template ngbPaginationNext>{{"Next" | translate}}</ng-template>
                    </ngb-pagination>
                </div>
            </div>
        </div>

    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
            {{"Close"| translate}}
        </button>
    </div>
</ng-template>
