<div class="modern-card allowance-card">
    <div class="card-header">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <div class="card-title-section">
                <h4 class="card-title">
                    <span class="material-symbols-outlined me-2">payments</span>
                    {{"Allowance" | translate}}
                </h4>
                <p class="card-subtitle text-muted mb-0">{{ 'allowance.subtitle' | translate }}</p>
            </div>
            <div class="card-actions">
                <button class="btn btn-outline-primary btn-sm" (click)="refreshData()">
                    <i class="mdi mdi-refresh me-1"></i>
                    {{ 'Refresh' | translate }}
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">

        <!-- Allowance Form (Top Section) -->
        <div class="allowance-form-grid mb-4">
            <div class="mb-3">
                <label class="form-label">{{"Group Allowance Code"| translate}}</label>
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="{{'Group Allowance Code'| translate}}"
                        [(ngModel)]="memplGroupallowance.groupallowanceId"
                        (ngModelChange)="groupallowanceIdChange($event)">
                    <button class="btn btn-outline-secondary btn-icon" type="button"
                        (click)="openAllowanceModal(allowanceModal)"
                        [attr.aria-label]="'Search' | translate"
                        [title]="'Search' | translate">
                        <span class="material-symbols-outlined">search</span>
                    </button>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">{{"FORENOON"| translate}}</label>
                <input type="number" class="form-control" placeholder="{{'0.00'| translate}}"
                    [(ngModel)]="memplGroupallowance.forenoon"
                    (ngModelChange)="memplGroupallowance.forenoon = formatNumberInput($event)">
            </div>
            <div class="mb-3">
                <label class="form-label">{{"Midday"| translate}}</label>
                <input type="number" class="form-control" placeholder="{{'0.00'| translate}}"
                    [(ngModel)]="memplGroupallowance.midday"
                    (ngModelChange)="memplGroupallowance.midday = formatNumberInput($event)">
            </div>
            <div class="mb-3">
                <label class="form-label">{{"Twilight"| translate}}</label>
                <input type="number" class="form-control" placeholder="{{'0.00'| translate}}"
                    [(ngModel)]="memplGroupallowance.twilight"
                    (ngModelChange)="memplGroupallowance.twilight = formatNumberInput($event)">
            </div>
            <div class="mb-3">
                <label class="form-label">{{"All day"| translate}}</label>
                <input type="number" class="form-control" placeholder="{{'0.00'| translate}}"
                    [(ngModel)]="memplGroupallowance.allday"
                    (ngModelChange)="memplGroupallowance.allday = formatNumberInput($event)">
            </div>
        </div>
        <div class="mb-3"></div>
        <div class="form-group-buttons text-end">
            <button type="button" class="btn btn-danger"
                [disabled]="memplGroupallowance.groupallowanceId=='' || isSaving" (click)="deleteMemplGroupallowance()">
                <span *ngIf="!isSaving">
                    <span class="icon-symbol me-1">üóëÔ∏è</span> {{"Delete"| translate}}
                </span>
                <span *ngIf="isSaving" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            </button>
        </div>
    </div>

    <!-- Position List Table -->
    <div class="row mb-3">
        <div class="col-12 d-flex justify-content-end align-items-center mb-2">
            <span class="stats-badge">
                {{'all'| translate}} <strong class="text-primary mx-1">{{memplGroupAllowance1List.length}}</strong>
                {{'position' | translate}}
            </span>
        </div>
        <div class="col-12">
            <div class="table-responsive d-none d-lg-block">
                <table class="table table-hover v-middle">
                    <thead class="thead-light">
                        <tr>
                            <th class="text-center col-checkbox">
                                <label for="selectAllCheckbox" class="visually-hidden">{{'Select all' | translate}}</label>
                                <input type="checkbox" [ngModel]="checkboxAll" (ngModelChange)="selectAll($event)"
                                    [attr.aria-label]="'Select all' | translate"
                                    [title]="'Select all' | translate"
                                    [attr.id]="'selectAllCheckbox'">
                            </th>
                            <th class="text-center col-number">{{"No." | translate}}</th>
                            <th>{{"Position" | translate}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngIf="memplGroupAllowance1List.length==0">
                            <td colspan="3" class="text-center text-muted py-4">{{"No Data Found" | translate}}</td>
                        </tr>
                        <tr
                            *ngFor="let item of memplGroupAllowance1List| slice:(page-1) * pageSize : (page-1) * pageSize + pageSize;let i = index">
                            <td class="text-center">
                                <label [for]="'selectItem' + i" class="visually-hidden">{{'Select item' | translate}}</label>
                                <input type="checkbox" [(ngModel)]="item.checkbox"
                                    [attr.aria-label]="'Select item' | translate"
                                    [title]="'Select item' | translate"
                                    [attr.id]="'selectItem' + i">
                            </td>
                            <td class="text-center">{{((page-1) * pageSize)+(i+1)}}</td>
                            <td>
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="{{'Position Code'| translate}}"
                                        [(ngModel)]="item.data.mposition.positionId"
                                        (ngModelChange)="positionIdChange($event,i)">
                                    <button class="btn btn-outline-secondary btn-icon" type="button"
                                        (click)="openPositionModal(positionModal,i)"
                                        [attr.aria-label]="'Search' | translate"
                                        [title]="'Search' | translate">
                                        <span class="material-symbols-outlined">search</span>
                                    </button>
                                </div>
                                <input type="text" class="form-control mt-2" readonly
                                    placeholder="{{ getName('‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á', 'Position Name') }}"
                                    [value]="getName(item.data.mposition.tdesc,item.data.mposition.edesc)">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Mobile Card View -->
            <div class="d-lg-none mt-3">
                <div *ngIf="memplGroupAllowance1List.length==0" class="text-center text-muted py-4">{{"No Data Found" |
                    translate}}</div>
                <div *ngFor="let item of memplGroupAllowance1List| slice:(page-1) * pageSize : (page-1) * pageSize + pageSize;let i = index"
                    class="allowance-position-card-mobile">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" [(ngModel)]="item.checkbox"
                                    [attr.aria-label]="'Select item' | translate"
                                    [title]="'Select item' | translate"
                                    [attr.id]="'selectItemMobile' + i">
                                <label class="form-check-label" [for]="'selectItemMobile' + i">{{"No." | translate}} {{((page-1) *
                                    pageSize)+(i+1)}}</label>
                            </div>
                            <button class="btn btn-outline-secondary btn-icon" type="button"
                                (click)="openPositionModal(positionModal,i)"
                                [attr.aria-label]="'Search' | translate"
                                [title]="'Search' | translate">
                                <span class="material-symbols-outlined">search</span>
                            </button>
                        </div>
                        <div class="info-row">
                            <div class="info-item"><span>{{"Position Code" |
                                    translate}}</span><strong>{{item.data.mposition.positionId}}</strong></div>
                            <div class="info-item"><span>{{"Position Name" |
                                    translate}}</span><strong>{{getName(item.data.mposition.tdesc,item.data.mposition.edesc)}}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination-controls d-flex justify-content-end p-2">
                <label for="pageSizeSelect" class="visually-hidden">{{'Items per page' | translate}}</label>
                <select class="form-select" [(ngModel)]="pageSize" (ngModelChange)="page=1"
                    [attr.aria-label]="'Items per page' | translate"
                    [title]="'Items per page' | translate"
                    [attr.id]="'pageSizeSelect'">
                    <option [ngValue]="10">{{"Items per page"| translate}}: 10</option>
                    <option [ngValue]="50">{{"Items per page"| translate}}: 50</option>
                    <option [ngValue]="100">{{"Items per page"| translate}}: 100</option>
                </select>
                <ngb-pagination [collectionSize]="memplGroupAllowance1List.length" [(page)]="page" [pageSize]="pageSize"
                    [maxSize]="3" [rotate]="true" [boundaryLinks]="true">
                    <ng-template ngbPaginationPrevious><i class="mdi mdi-chevron-left"></i></ng-template>
                    <ng-template ngbPaginationNext><i class="mdi mdi-chevron-right"></i></ng-template>
                </ngb-pagination>
            </div>
        </div>

        <!-- Main Action Buttons -->
        <div class="row">
            <div class="col-12 d-flex justify-content-center align-items-center mt-3">
                <button type="button" class="btn btn-outline-primary me-2" (click)="addMemplGroupAllowance1()">
                    <span class="icon-symbol me-1">‚ûï</span> {{"Add"| translate}}
                </button>
                <button type="button" class="btn btn-success me-2"
                    [disabled]="memplGroupallowance.groupallowanceId=='' || isSaving"
                    (click)="saveMemplGroupallowance()">
                    <span *ngIf="!isSaving">
                        <span class="icon-symbol me-1">üíæ</span> {{"Save"| translate}}
                    </span>
                    <span *ngIf="isSaving" class="spinner-border spinner-border-sm" role="status"
                        aria-hidden="true"></span>
                </button>
                <button type="button" class="btn btn-danger" (click)="deleteMemplGroupAllowance1()">
                    <span class="icon-symbol me-1">üóëÔ∏è</span> {{"Delete"| translate}}
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <ng-template #allowanceModal let-modal>
        <div class="modal-header justify-content-between">
            <h5 class="modal-title">{{"Group Allowance Code" | translate}}</h5>
            <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="search-input-container mb-3">
                <span class="material-symbols-outlined">search</span>
                <input type="text" class="form-control"
                    placeholder="{{ getName('‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', 'Search Group Allowance Code') }}"
                    [ngModel]="searchModal" (ngModelChange)="modalSearchChange('allowanceSearch',$event)">
            </div>
            <div class="table-responsive">
                <table class="table table-hover v-middle">
                    <thead class="thead-light">
                        <tr>
                            <th>{{"Group Allowance Code"| translate}}</th>
                            <th>{{"FORENOON"| translate}}</th>
                            <th>{{"Midday"| translate}}</th>
                            <th>{{"Twilight"| translate}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngIf="memplGroupAllowanceListLoading">
                            <td colspan="4" class="text-center py-4">
                                <div class="spinner-border text-primary" role="status"></div>
                            </td>
                        </tr>
                        <tr *ngIf="!memplGroupAllowanceListLoading && memplGroupAllowanceList.length == 0">
                            <td colspan="4" class="text-center text-muted py-4">{{"No Data Found" | translate}}</td>
                        </tr>
                        <tr class="cursor-myhr"
                            *ngFor="let item of memplGroupAllowanceList | slice: (pageModal-1) * pageSizeModal : ((pageModal-1) * pageSizeModal) + pageSizeModal; let i=index"
                            (click)="modal.close(item)">
                            <td>{{item.groupallowanceId}}</td>
                            <td>{{item.forenoon}}</td>
                            <td>{{item.midday}}</td>
                            <td>{{item.twilight}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="pagination-controls d-flex justify-content-end p-2">
                <label for="pageSizeModalSelect" class="visually-hidden">{{'Items per page' | translate}}</label>
                <select class="form-select" [(ngModel)]="pageSizeModal" (ngModelChange)="pageModal=1"
                    [attr.aria-label]="'Items per page' | translate"
                    [title]="'Items per page' | translate"
                    [attr.id]="'pageSizeModalSelect'">
                    <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
                    <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
                    <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
                </select>
                <ngb-pagination [collectionSize]="memplGroupAllowanceList.length" [(page)]="pageModal"
                    [pageSize]="pageSizeModal" [maxSize]="3" [rotate]="true" [boundaryLinks]="true">
                    <ng-template ngbPaginationPrevious><i class="mdi mdi-chevron-left"></i></ng-template>
                    <ng-template ngbPaginationNext><i class="mdi mdi-chevron-right"></i></ng-template>
                </ngb-pagination>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
                {{"Close"| translate}}
            </button>
        </div>
    </ng-template>
    <ng-template #positionModal let-modal>
        <div class="modal-header">
            <h5 class="modal-title">{{"Position Table" | translate}}</h5>
            <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="search-input-container mb-3">
                <span class="material-symbols-outlined">search</span>
                <input type="text" class="form-control"
                    placeholder="{{ getName('‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á / ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á', 'Search Position Code / Position Name') }}"
                    [ngModel]="searchModal" (ngModelChange)="modalSearchChange('positionSearch',$event)">
            </div>
            <div class="table-responsive">
                <table class="table table-hover v-middle">
                    <thead class="thead-light">
                        <tr>
                            <th>{{"Position Code"| translate}}</th>
                            <th>{{"Position. (Thai)"| translate}}</th>
                            <th>{{"Position. (Eng.)"| translate}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngIf="positionListLoading">
                            <td colspan="3" class="text-center py-4">
                                <div class="spinner-border text-primary" role="status"></div>
                            </td>
                        </tr>
                        <tr *ngIf="!positionListLoading && positionList.length == 0">
                            <td colspan="3" class="text-center text-muted py-4">{{"No Data Found" | translate}}</td>
                        </tr>
                        <tr class="cursor-myhr"
                            *ngFor="let item of positionList | slice: (pageModal-1) * pageSizeModal : ((pageModal-1) * pageSizeModal) + pageSizeModal; let i=index"
                            (click)="modal.close(item)">
                            <td>{{item.positionId}}</td>
                            <td>{{item.tdesc}}</td>
                            <td>{{item.edesc}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="pagination-controls d-flex justify-content-end p-2">
                <label for="pageSizeModalSelect" class="visually-hidden">{{'Items per page' | translate}}</label>
                <select class="form-select" [(ngModel)]="pageSizeModal" (ngModelChange)="pageModal=1"
                    [attr.aria-label]="'Items per page' | translate"
                    [title]="'Items per page' | translate"
                    [attr.id]="'pageSizeModalSelect'">
                    <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
                    <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
                    <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
                </select>
                <ngb-pagination [collectionSize]="positionList.length" [(page)]="pageModal" [pageSize]="pageSizeModal"
                    [maxSize]="3" [rotate]="true" [boundaryLinks]="true">
                    <ng-template ngbPaginationPrevious><i class="mdi mdi-chevron-left"></i></ng-template>
                    <ng-template ngbPaginationNext><i class="mdi mdi-chevron-right"></i></ng-template>
                </ngb-pagination>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
                {{"Close"| translate}}
            </button>
        </div>
    </ng-template>
