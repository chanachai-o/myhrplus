<!--
  GEMINI DESIGN SYSTEM
  File: shift.component.html
  Description: Responsive layout for Shift Allowance page.
  - Re-structured the top form using a responsive .filter-bar layout.
  - Implemented the standard responsive table pattern:
    - The original table is now wrapped in .d-none.d-lg-block.
    - A new mobile-friendly card view (.d-lg-none) is created using @for, including all necessary input controls.
  - Re-organized action buttons for better clarity and grouping.
  - Switched from *ngIf/*ngFor to modern @if/@for syntax.
-->
<div class="modern-card shift-card">
    <div class="card-header">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <div class="card-title-section">
                <h4 class="card-title">
                    <span class="material-symbols-outlined me-2">schedule</span>
                    {{"Shift Allowance" | translate}}
                </h4>
                <p class="card-subtitle text-muted mb-0">{{ "Manage shift allowance configurations" | translate }}</p>
            </div>
            <div class="card-actions">
                <button type="button" class="btn btn-outline-primary btn-sm" (click)="refreshData()"
                    [attr.aria-label]="'Refresh' | translate"
                    [title]="'Refresh' | translate">
                    <span class="material-symbols-outlined">refresh</span>
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <!-- Filter/Search Form -->
        <div class="filter-bar mb-4">
            <div class="row w-100">
                <!-- Shift -->
                <div class="col-lg-3 col-md-6 col-12 mb-3">
                    <label class="form-label fw-bold">{{"Shift"| translate}}</label>
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="{{'Shift ID'| translate}}" maxlength="3"
                            [(ngModel)]="vshiftModel.shiftId">
                        <button class="btn btn-primary btn-icon" type="button" (click)="openBranchModal(shiftModal,-1)"
                            [attr.aria-label]="'Search' | translate"
                            [title]="'Search' | translate">
                            <span class="material-symbols-outlined">search</span>
                        </button>
                    </div>
                </div>

                <!-- Descriptions -->
                <div class="col-lg-3 col-md-6 col-12 mb-3">
                    <label class="form-label fw-bold">{{"Desc. (Thai)"| translate }}</label>
                    <input type="text" placeholder="{{'Desc. (Thai)'| translate }}" class="form-control" maxlength="100"
                        [(ngModel)]="vshiftModel.tdesc">
                </div>
                <div class="col-lg-3 col-md-6 col-12 mb-3">
                    <label class="form-label fw-bold">{{"Desc. (Eng.)"| translate }}</label>
                    <input type="text" placeholder="{{'Desc. (Eng.)'| translate }}" class="form-control" maxlength="100"
                        [(ngModel)]="vshiftModel.edesc">
                </div>

                <!-- Effective Date -->
                <div class="col-lg-3 col-md-6 col-12 mb-3">
                    <label class="form-label fw-bold">{{"Effective Date"| translate}}</label>
                    <div class="input-group">
                        <input class="form-control" placeholder="{{'dd.mm.yyyy' | translate}}" name="dp1" ngbDatepicker
                            #d1="ngbDatepicker" [(ngModel)]="date" [ngClass]="{'is-invalid':!checkDateFormat(date)}"
                            #c1="ngModel" (change)="date = datepickerService.validateFormatDate(c1)">
                        <button class="btn btn-outline-primary btn-icon" (click)="d1.toggle()" type="button"
                            [attr.aria-label]="'Select Date' | translate"
                            [title]="'Select Date' | translate">
                            <span class="material-symbols-outlined">calendar_today</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-end mb-3">
            <button type="button" class="btn btn-danger" [disabled]="!vshiftModel.shiftId" (click)="deleteVSift();"
                [attr.aria-label]="'Delete' | translate"
                [title]="'Delete' | translate">
                <span class="material-symbols-outlined me-1">delete</span>
                {{"systemcode.delete"| translate}}
            </button>
        </div>

        <hr>

        <!-- Shift Details Section -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">
                <span class="icon-symbol me-2">üìã</span>
                {{"Shift Details" | translate}}
            </h5>
            <div class="stats-badge">
                <span class="badge-text">{{"Total"| translate}}</span>
                <span class="badge-count">{{shift.length}}</span>
            </div>
        </div>

        <!-- Desktop Table View -->
        <div class="d-none d-lg-block">
            <div class="table-responsive">
                <table class="table modern-table">
                    <thead>
                        <tr>
                            <th class="col-checkbox">
                                <input type="checkbox" class="form-check-input" [(ngModel)]="checkbox"
                                    (ngModelChange)="selectAll()"
                                    [attr.aria-label]="'Select All' | translate"
                                    [title]="'Select All' | translate"
                                    [attr.id]="'selectAllCheckbox'"
                                    [attr.name]="'selectAllCheckbox'"
                                    placeholder="Select All">
                            </th>
                            <th class="col-number">{{"No."| translate}}</th>
                            <th class="col-duration">{{"Duration"| translate}}</th>
                            <th class="col-amount">{{"Amounts"| translate}}</th>
                            <th class="col-checkin">{{"Check In"| translate}}</th>
                            <th class="col-workarea">{{"Work Area Group"| translate}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (shift.length === 0) {
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">{{"No Data Found" | translate}}</td>
                        </tr>
                        }
                        @for (item of shift | slice:(page-1) * pageSize : (page-1) * pageSize + pageSize; track
                        item.data.lineNo; let i = $index) {
                        <tr>
                            <td class="text-center">
                                <input type="checkbox" class="form-check-input" [(ngModel)]="item.checkbox"
                                    [attr.aria-label]="'Select item' | translate"
                                    [title]="'Select item' | translate"
                                    [attr.id]="'selectItem_' + item.data.lineNo"
                                    [attr.name]="'selectItem_' + item.data.lineNo"
                                    placeholder="Select item">
                            </td>
                            <td class="text-center">{{ (page-1) * pageSize + i + 1 }}</td>
                            <td>
                                <div class="d-flex align-items-center justify-content-center duration-inputs">
                                    <input type="time" class="form-control" [(ngModel)]="item.data.rstart"
                                        [attr.aria-label]="'Start time' | translate"
                                        [title]="'Start time' | translate"
                                        [attr.id]="'rstart_' + item.data.lineNo"
                                        [attr.name]="'rstart_' + item.data.lineNo"
                                        placeholder="HH:MM">
                                    <span class="time-separator">-</span>
                                    <input type="time" class="form-control" [(ngModel)]="item.data.rend"
                                        [attr.aria-label]="'End time' | translate"
                                        [title]="'End time' | translate"
                                        [attr.id]="'rend_' + item.data.lineNo"
                                        [attr.name]="'rend_' + item.data.lineNo"
                                        placeholder="HH:MM">
                                </div>
                            </td>
                            <td>
                                <input type="text" class="form-control text-end amount-input"
                                    oninput="this.value = this.value.replace(/[^\d.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/(\..*?)(\d{2})./g, '$1$2');"
                                    onchange="this.value = this.value.replace('', '0');this.value = parseFloat(this.value).toFixed(2)"
                                    [(ngModel)]="item.data.amountMoney"
                                    [attr.aria-label]="'Amount' | translate"
                                    [title]="'Amount' | translate"
                                    [attr.id]="'amount_' + item.data.lineNo"
                                    [attr.name]="'amount_' + item.data.lineNo"
                                    placeholder="0.00">
                            </td>
                            <td>
                                <select class="form-select" [(ngModel)]="item.data.checkZone"
                                    [attr.aria-label]="'Check In' | translate"
                                    [title]="'Check In' | translate"
                                    [attr.id]="'checkZone_' + item.data.lineNo"
                                    [attr.name]="'checkZone_' + item.data.lineNo">
                                    @for (zone of zoneList; track zone.zoneid) {
                                    <option [ngValue]="zone.zoneid">{{getName(zone.tdesc,zone.edesc)}}</option>
                                    }
                                </select>
                            </td>
                            <td>
                                <div class="input-group workarea-group">
                                    <input type="text" class="form-control" placeholder="{{'Group ID' | translate}}"
                                        [(ngModel)]="item.data.gworkarea0.groupId"
                                        (ngModelChange)="searchShiftId($event, i)"
                                        [attr.aria-label]="'Group ID' | translate"
                                        [title]="'Group ID' | translate"
                                        [attr.id]="'groupId_' + item.data.lineNo"
                                        [attr.name]="'groupId_' + item.data.lineNo">
                                    <button class="btn btn-primary btn-icon" type="button"
                                        (click)="openBranchModal(branchModal, i)"
                                        [attr.aria-label]="'Search' | translate"
                                        [title]="'Search' | translate">
                                        <span class="material-symbols-outlined">search</span>
                                    </button>
                                    <span class="input-group-text text-truncate workarea-display"
                                        [title]="getName(item.data.gworkarea0.tdesc,item.data.gworkarea0.edesc)">
                                        {{getName(item.data.gworkarea0.tdesc,item.data.gworkarea0.edesc) || '---'}}
                                    </span>
                                </div>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Mobile Card View -->
        <div class="d-lg-none mt-3">
            @if (shift.length === 0) {
            <div class="empty-state">
                <div class="empty-icon">‚è∞</div>
                <p>{{"No Data Found" | translate}}</p>
            </div>
            }
            @for (item of shift | slice:(page-1) * pageSize : (page-1) * pageSize + pageSize; track item.data.lineNo;
            let i = $index) {
            <div class="shift-card-mobile">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="fw-bold">{{"No."| translate}} {{ (page-1) * pageSize + i + 1 }}</span>
                            <input type="checkbox" class="form-check-input" [(ngModel)]="item.checkbox"
                                [attr.aria-label]="'Select item' | translate"
                                [title]="'Select item' | translate"
                                [attr.id]="'mobile_selectItem_' + item.data.lineNo"
                                [attr.name]="'mobile_selectItem_' + item.data.lineNo"
                                placeholder="Select item">
                    </div>

                    <div class="info-item mb-3">
                        <label class="form-label">{{"Duration"| translate}}</label>
                        <div class="d-flex align-items-center duration-inputs">
                            <input type="time" class="form-control" [(ngModel)]="item.data.rstart"
                                [attr.aria-label]="'Start time' | translate"
                                [title]="'Start time' | translate"
                                [attr.id]="'mobile_rstart_' + item.data.lineNo"
                                [attr.name]="'mobile_rstart_' + item.data.lineNo"
                                placeholder="HH:MM">
                            <span class="time-separator">-</span>
                            <input type="time" class="form-control" [(ngModel)]="item.data.rend"
                                [attr.aria-label]="'End time' | translate"
                                [title]="'End time' | translate"
                                [attr.id]="'mobile_rend_' + item.data.lineNo"
                                [attr.name]="'mobile_rend_' + item.data.lineNo"
                                placeholder="HH:MM">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6 mb-3">
                            <label class="form-label">{{"Amounts"| translate}}</label>
                            <input type="text" class="form-control text-end amount-input"
                                oninput="this.value = this.value.replace(/[^\d.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/(\..*?)(\d{2})./g, '$1$2');"
                                onchange="this.value = this.value.replace('', '0');this.value = parseFloat(this.value).toFixed(2)"
                                [(ngModel)]="item.data.amountMoney"
                                [attr.aria-label]="'Amount' | translate"
                                [title]="'Amount' | translate"
                                [attr.id]="'mobile_amount_' + item.data.lineNo"
                                [attr.name]="'mobile_amount_' + item.data.lineNo"
                                placeholder="0.00">
                        </div>
                        <div class="col-6 mb-3">
                            <label class="form-label">{{"Check In"| translate}}</label>
                            <select class="form-select" [(ngModel)]="item.data.checkZone"
                                [attr.aria-label]="'Check In' | translate"
                                [title]="'Check In' | translate"
                                [attr.id]="'mobile_checkZone_' + item.data.lineNo"
                                [attr.name]="'mobile_checkZone_' + item.data.lineNo">
                                @for (zone of zoneList; track zone.zoneid) {
                                <option [ngValue]="zone.zoneid">{{getName(zone.tdesc,zone.edesc)}}</option>
                                }
                            </select>
                        </div>
                    </div>

                    <div class="info-item mb-2">
                        <label class="form-label">{{"Work Area Group"| translate}}</label>
                        <div class="input-group workarea-group">
                            <input type="text" class="form-control" placeholder="{{'Group ID' | translate}}"
                                [(ngModel)]="item.data.gworkarea0.groupId" (ngModelChange)="searchShiftId($event, i)"
                                [attr.aria-label]="'Group ID' | translate"
                                [title]="'Group ID' | translate"
                                [attr.id]="'mobile_groupId_' + item.data.lineNo"
                                [attr.name]="'mobile_groupId_' + item.data.lineNo">
                            <button class="btn btn-primary btn-icon" type="button"
                                (click)="openBranchModal(branchModal, i)"
                                [attr.aria-label]="'Search' | translate"
                                [title]="'Search' | translate">
                                <span class="material-symbols-outlined">search</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            }
        </div>

        <!-- Pagination -->
        <div class="pagination-controls d-flex flex-wrap justify-content-end align-items-center p-2 mt-3">
            <select class="form-select me-2 mb-2 mb-md-0 page-size-select" [(ngModel)]="pageSize"
                (ngModelChange)="page=1"
                [attr.aria-label]="'Items per page' | translate"
                [title]="'Items per page' | translate">
                <option [ngValue]="10">{{"Items per page"| translate}}: 10</option>
                <option [ngValue]="50">{{"Items per page"| translate}}: 50</option>
                <option [ngValue]="100">{{"Items per page"| translate}}: 100</option>
            </select>
            <ngb-pagination [collectionSize]="shift.length" [(page)]="page" [pageSize]="pageSize" [maxSize]="3"
                [rotate]="true" [boundaryLinks]="true">
                <ng-template ngbPaginationPrevious><span class="material-symbols-outlined">chevron_left</span></ng-template>
                <ng-template ngbPaginationNext><span class="material-symbols-outlined">chevron_right</span></ng-template>
            </ngb-pagination>
        </div>

        <hr>

        <!-- Action Buttons -->
        <div class="d-flex justify-content-center align-items-center gap-2 mt-3">
            <button type="button" class="btn btn-primary" (click)="addShift()"
                [attr.aria-label]="'Add' | translate"
                [title]="'Add' | translate">
                <span class="material-symbols-outlined me-1">add</span>
                {{"systemcode.add" | translate}}
            </button>
            <button type="button" class="btn btn-danger" (click)="deleteShift()"
                [attr.aria-label]="'Delete' | translate"
                [title]="'Delete' | translate">
                <span class="material-symbols-outlined me-1">delete</span>
                {{"systemcode.delete" | translate}}
            </button>
            <button type="button" class="btn btn-success" (click)="onSubmit()" [disabled]="!vshiftModel.shiftId"
                [attr.aria-label]="'Save' | translate"
                [title]="'Save' | translate">
                <span class="material-symbols-outlined me-1">save</span>
                {{"Save" | translate}}
            </button>
        </div>
    </div>
</div>

<!-- Modals remain unchanged -->
<ng-template #shiftModal let-modal>
    <div class="modal-body">
        <div class="card modal-card">
            <div class="modal-header">
                <h5 class="modal-title">
                    <span class="material-symbols-outlined me-2">schedule</span>
                    {{"Shift" | translate}}
                </h5>
                <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close">
                </button>
            </div>
            <div class="card-body pt-0 pt-2">
                <div class="d-flex col-5 mb-1 p-0 search-container">
                    <input type="text" [(ngModel)]="searchText" (ngModelChange)="searchFilter('shift')"
                        placeholder="{{'systemcode.search' | translate}} {{('Shift ID' | translate) + ' / ' + ('Desc.' | translate)}}"
                        class="form-control">
                </div>
                <div class="table-responsive">
                    <table class="table  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
                        <thead class="bg-info ">
                            <tr class="text-white font-weight-normal">
                                <th class="font-weight-normal text-center" scope="col">{{"Shift ID"| translate}}
                                </th>
                                <th class="font-weight-normal text-center" scope="col">{{"Effective Date"|
                                    translate}}</th>
                                <th class="font-weight-normal text-center" scope="col">{{"Desc. (Thai)"|
                                    translate}}</th>
                                <th class="font-weight-normal text-center" scope="col">{{"Desc. (Eng.)"|
                                    translate}}</th>
                                <th class="font-weight-normal text-center" scope="col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (vshiftListShow.length == 0) {
                            <tr>
                                <td colspan="5" class="font-weight-normal text-center">
                                    {{"No Data Found" | translate}}
                                </td>
                            </tr>
                            }
                            @for (item of vshiftListShow| slice: (page-1) * pageSize : (page-1) * pageSize + pageSize;
                            track item.shiftId) {
                            <tr class="cursor-pointer" (click)="selectShift(item);modal.dismiss();">
                                <td class="font-weight-normal text-center">{{item.shiftId?item.shiftId:'-'}}</td>
                                <td class="font-weight-normal text-center">{{item.effDate | date:'dd/MM/yyyy'}}</td>
                                <td class="font-weight-normal text-center">{{item.tdesc?item.tdesc:'-'}}</td>
                                <td class="font-weight-normal text-center">{{item.edesc?item.edesc:'-'}}</td>
                                <td class="font-weight-normal text-center">
                                    <button type="button" class="btn btn-info btn-sm choose-btn">
                                        {{"choose"| translate}}
                                    </button>
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-end p-2">
                    <select class="form-select me-2 page-size-select" [(ngModel)]="pageSize"
                        (ngModelChange)="page=1">
                        <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
                        <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
                        <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
                    </select>
                    <ngb-pagination [collectionSize]="vshiftListShow.length" [(page)]="page" [pageSize]="pageSize"
                        [maxSize]="3" [rotate]="true">
                        <ng-template ngbPaginationPrevious>{{"Prev" | translate}}</ng-template>
                        <ng-template ngbPaginationNext>{{"Next" | translate}}</ng-template>
                    </ngb-pagination>
                </div>
            </div>
        </div>

    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
            {{"Close"| translate}}
        </button>
    </div>
</ng-template>

<ng-template #branchModal let-modal>
    <div class="modal-body">
        <div class="card modal-card">
            <div class="modal-header">
                <h5 class="modal-title">
                    <span class="material-symbols-outlined me-2">business</span>
                    {{"Work Area Group" | translate}}
                </h5>
                <button type="button" class="btn-close" (click)="modal.dismiss('Cross click')" aria-label="Close">
                </button>
            </div>
            <div class="card-body pt-0 pt-2">
                <div class="d-flex col-5 mb-1 p-0 search-container">
                    <input type="text" [(ngModel)]="searchText" (ngModelChange)="searchFilter('job')"
                        placeholder="{{'systemcode.search' | translate}} {{('group.id' | translate) + ' / ' + ('Desc.' | translate)}}"
                        class="form-control">
                </div>
                <div class="table-responsive">
                    <table class="table  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
                        <thead class="bg-info ">
                            <tr class="text-white font-weight-normal">
                                <th class="font-weight-normal text-center" scope="col">{{"group.id"| translate}}
                                </th>
                                <th class="font-weight-normal text-center" scope="col">{{"detailTH"|
                                    translate}}</th>
                                <th class="font-weight-normal text-center" scope="col">{{"detailENG"|
                                    translate}}</th>
                                <th class="font-weight-normal text-center" scope="col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (workareaListShow.length == 0) {
                            <tr>
                                <td colspan="4" class="font-weight-normal text-center">
                                    {{"No Data Found" | translate}}
                                </td>
                            </tr>
                            }
                            @for (item of workareaListShow| slice: (page-1) * pageSize : (page-1) * pageSize + pageSize;
                            track item.groupId) {
                            <tr class="cursor-pointer" (click)="selectWorkArea(item);modal.dismiss();">
                                <td class="font-weight-normal text-center">{{item.groupId?item.groupId:'-'}}</td>
                                <td class="font-weight-normal text-center">{{item.tdesc?item.tdesc:'-'}}</td>
                                <td class="font-weight-normal text-center">{{item.edesc?item.edesc:'-'}}</td>
                                <td class="font-weight-normal text-center">
                                    <button type="button" class="btn btn-info btn-sm choose-btn">
                                        {{"choose"| translate}}
                                    </button>
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-end p-2">
                    <select class="form-select me-2 page-size-select" [(ngModel)]="pageSize"
                        (ngModelChange)="page=1">
                        <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
                        <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
                        <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
                    </select>
                    <ngb-pagination [collectionSize]="workareaListShow.length" [(page)]="page" [pageSize]="pageSize"
                        [maxSize]="3" [rotate]="true">
                        <ng-template ngbPaginationPrevious>{{"Prev" | translate}}</ng-template>
                        <ng-template ngbPaginationNext>{{"Next" | translate}}</ng-template>
                    </ngb-pagination>
                </div>
            </div>
        </div>

    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.dismiss()">
            {{"Close"| translate}}
        </button>
    </div>
</ng-template>

<ng-template #confirmModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="editLabel">{{"Alert Message" | translate}}</h5>
        <button type="button" class="btn-close" (click)="modal.dismiss('Close')" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        {{msg | translate}}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-info" (click)="modal.close()">{{"confirm"| translate}}</button>
        <button type="button" class="btn btn-danger" (click)="modal.dismiss('Close')">{{"cancel"|
            translate}}</button>
    </div>
</ng-template>
<ng-template #alertModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="editLabel">{{"Alert Message" | translate}}</h5>
        <button type="button" class="btn-close" (click)="modal.dismiss('Close')" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col-12">
                {{msg}}
            </div>
        </div>
    </div>
</ng-template>
