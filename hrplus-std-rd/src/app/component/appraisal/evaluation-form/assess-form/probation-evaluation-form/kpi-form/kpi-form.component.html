<div class="row">
    <div class="col-12" style="padding: 1px;">
        <h6 class="border-form text-center">
            ตัวชี้วัดผลการปฏิบัติงานรายบุคคล {{jobName}}
        </h6>
    </div>
    <div class="row m-0 col-2 p-0">
        <div class="col-2" style="padding: 1px;">
            <h6 class="border-form text-center">
                No
            </h6>
        </div>
        <div class="col-10" style="padding: 1px;">
            <h6 class="border-form text-center">
                Topic
            </h6>
        </div>
    </div>
    <div class="col-1" style="padding: 1px;">
        <h6 class="border-form text-center">
            Target
        </h6>
    </div>
    <div class="row m-0 col-4 p-0">
        <div class="col-8" style="padding: 1px;">
            <h6 class="border-form text-center">
                ทดลองงาน
            </h6>
        </div>
        <div class="col-4" style="padding: 1px;">
            <h6 class="border-form text-center">
                Score
            </h6>
        </div>
    </div>
    <div class="row m-0 col-5 p-0">
        <div class="row m-0 col-7 p-0">
            <div class="col-4" style="padding: 1px;">
                <h6 class="border-form text-center">
                </h6>
            </div>
            <div class="row m-0 col-8 p-0">
                <div class="col-12" style="padding: 1px;">
                    <div class="border-form text-center">
                        ทดลองงาน
                    </div>
                </div>
                <div class="col-6" style="padding: 1px;">
                    <div class="border-form text-center">
                        ประเมินตนเอง
                    </div>
                </div>

                <div class="col-6" style="padding: 1px;">
                    <div class="border-form text-center">
                        ผู้บังคับบัญชา
                    </div>
                </div>
            </div>
        </div>

        <div class="row m-0 col-5 p-0">
            <div class="col-12" style="padding: 1px;">
                <div class="border-form text-center">
                    Final
                </div>
            </div>
            <div class="col-6" style="padding: 1px;">
                <div class="border-form text-center">
                    ประเมินตนเอง
                </div>
            </div>
            <div class="col-6" style="padding: 1px;">
                <div class="border-form text-center">
                    ผู้บังคับบัญชา
                </div>
            </div>
        </div>
    </div>
    <ng-container *ngFor="let items of kpiformDetail.masform1DetailV2Models[0].assessDetails;let i = index">
        <div class="row m-0 col-2 p-0">
            <div class="col-2" style="padding: 1px;">
                <div class="border-form text-center">
                    {{i+1}}
                </div>
            </div>
            <div class="col-10" style="padding: 1px;">
                <div class="border-form text-center">
                    {{getText(items.tdesc,items.edesc)}}
                </div>
            </div>
        </div>
        <div class="col-1" style="padding: 1px;">
            <div class="border-form text-center">
                {{items.asobject}}
            </div>
        </div>
        <div class="row m-0 col-4 p-0">
            <div class="row m-0 col-12" style="padding: 1px;">
                <ng-container
                    *ngFor="let item of (items.masanswerl.length>=masformDetail.kpiCategory.length)?items.masanswerl:masformDetail.kpiCategory;let i = index">
                    <div class="row m-0 col-8 p-0">
                        <div class="col-12" style="padding: 1px;">
                            <span class="border-form text-center"
                                *ngIf="items.masanswerl.length>=masformDetail.kpiCategory.length">
                                {{getText(item.tdesc,item.edesc)}}
                            </span>
                            <span class="border-form text-center"
                                *ngIf="items.masanswerl.length<masformDetail.kpiCategory.length && i<items.masanswerl.length">
                                {{getText(items.masanswerl[i].tdesc,items.masanswerl[i].edesc)}}
                            </span>
                        </div>
                    </div>
                    <div class="row m-0 col-4 p-0">
                        <div class="col-8" style="padding: 1px;">
                            <span class="border-form text-center"
                                *ngIf="items.masanswerl.length>=masformDetail.kpiCategory.length && i<masformDetail.kpiCategory.length">
                                {{getText(masformDetail.kpiCategory[i].tdesc,masformDetail.kpiCategory[i].edesc)}}
                            </span>
                            <span class="border-form text-center"
                                *ngIf="items.masanswerl.length<masformDetail.kpiCategory.length ">
                                {{getText(item.tdesc,item.edesc)}}
                            </span>
                        </div>
                        <div class="col-4" style="padding: 1px;">
                            <div class="border-form text-center"
                                *ngIf="items.masanswerl.length>=masformDetail.kpiCategory.length  && i<masformDetail.kpiCategory.length">
                                {{masformDetail.kpiCategory[i].kcatId}}
                            </div>
                            <div class="border-form text-center"
                                *ngIf="items.masanswerl.length<masformDetail.kpiCategory.length">
                                {{item.kcatId == -1 ? "N" : item.kcatId }}
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
            <div class="col-12" style="padding: 1px;">
                <div class="border-form text-center">
                    Result
                </div>
            </div>
            <div class="col-12" style="padding: 1px;">
                <div class="border-form text-center">
                    <textarea class="w-100" [(ngModel)]="items.resultDetail"
                        [disabled]="statusCompetencyKpiCheck('supervisor_finish')||!step"></textarea>
                </div>
            </div>
            <div class="col-12" style="padding: 1px;">
                <div class="border-form text-center">
                    <button type="button" class="btn btn-secondary  text-white mx-1" (click)="openModal(imgModal,i)">
                        {{"รูปภาพ" | translate}}
                        {{kpiformDetail.masform1DetailV2Models[0].assessDetails[i].image
                        !="browse_file"?kpiformDetail.masform1DetailV2Models[0].assessDetails[i].image:''}}
                    </button>
                </div>
            </div>
        </div>
        <div class="row m-0 col-5 p-0">
            <div class="row m-0 col-7 p-0">
                <div class="col-4" style="padding: 1px;">
                    <div class="border-form text-center">
                        Weight
                    </div>
                </div>
                <div class="row m-0 col-8 p-0">
                    <div class="col-6" style="padding: 1px;">
                        <span class="border-form text-center">
                            <input type="text" class="form-control" oninput="value = value.replace(/[^0-9]/g, '');"
                                [(ngModel)]="items.selfWeightScore"
                                [disabled]="statusCompetencyKpiCheck('supervisor')||(step!='0'&& !(step=='1'&&job=='P008'))">%
                        </span>
                    </div>
                    <div class="col-6" style="padding: 1px;">
                        <span class="border-form text-center">
                            <input type="text" class="form-control" oninput="value = value.replace(/[^0-9]/g, '');"
                                [(ngModel)]="items.bossWeightScore"
                                [disabled]="statusCompetencyKpiCheck('employee') || statusCompetencyKpiCheck('supervisor_finish')||step=='0'||!step">%
                        </span>
                    </div>
                </div>
                <div class="col-4" style="padding: 1px;">
                    <div class="border-form text-center">
                        Actual Score
                    </div>
                </div>
                <div class="row m-0 col-8 p-0">
                    <div class="row m-0 col-12 p-0">
                        <div class="col-6" style="padding: 1px;">
                            <span class="border-form text-center">
                                <input type="text" class="form-control" oninput="value = value.replace(/[^0-9]/g, '');"
                                    [(ngModel)]="items.selfActualScore"
                                    [disabled]="statusCompetencyKpiCheck('supervisor')||(step!='0'&& !(step=='1'&&job=='P008'))">
                            </span>
                        </div>
                        <div class="col-6" style="padding: 1px;">
                            <span class="border-form text-center">
                                <input type="text" class="form-control" oninput="value = value.replace(/[^0-9]/g, '');"
                                    [(ngModel)]="items.bossActualScore"
                                    [disabled]="statusCompetencyKpiCheck('employee') || statusCompetencyKpiCheck('supervisor_finish')||step=='0'||!step">
                            </span>
                        </div>
                    </div>
                    <div class="row m-0 col-12 p-0">
                        <div class="col-6" style="padding: 1px;">
                            <span class="border-form text-center">
                                {{calActualScoreSelf(items.selfWeightScore,items.selfActualScore)}}
                            </span>
                        </div>
                        <div class="col-6" style="padding: 1px;">
                            <span class="border-form text-center">
                                {{calActualScoreSelf(items.bossWeightScore,items.bossActualScore)}}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row m-0 col-5 p-0">
                <div class="col-6" style="padding: 1px;">
                    <span class="border-form text-center">
                        {{calActualScoreSelf(items.selfWeightScore,items.selfActualScore)}}
                    </span>
                </div>
                <div class="col-6" style="padding: 1px;">
                    <span class="border-form text-center">
                        {{calActualScoreSelf(items.bossWeightScore,items.bossActualScore)}}
                    </span>
                </div>
            </div>
        </div>
    </ng-container>
    <div class="col-7"></div>
    <div class="row m-0 col-5 p-0">
        <div class="row m-0 col-7 p-0">
            <div class="col-4" style="padding: 1px;">
                <div class="border-form text-center">
                    Total Weight
                </div>
            </div>
            <div class="row m-0 col-8 p-0">
                <div class="col-6" style="padding: 1px;">
                    <span class="border-form text-center">
                        {{calselfTotalWeight()}}%
                    </span>
                </div>
                <div class="col-6" style="padding: 1px;">
                    <span class="border-form text-center">
                        {{calbossTotalWeight()}}%
                    </span>
                </div>
            </div>
        </div>
        <div class="row m-0 col-5 p-0">
        </div>
    </div>
    <div class="col-7"></div>
    <div class="row m-0 col-5 p-0">
        <div class="row m-0 col-7 p-0">
            <div class="col-4" style="padding: 1px;">
                <div class="border-form text-center">
                    Total Score
                </div>
            </div>
            <div class="row m-0 col-8 p-0">
                <div class="col-6" style="padding: 1px;">
                    <span class="border-form text-center">
                        {{calselfTotal()}}
                    </span>
                </div>
                <div class="col-6" style="padding: 1px;">
                    <span class="border-form text-center">
                        {{calbossTotal()}}
                    </span>
                </div>
            </div>
        </div>
        <div class="row m-0 col-5 p-0">
            <div class="col-6" style="padding: 1px;">
                <span class="border-form text-center">
                    <!-- {{calselfTotalFinal()}} -->
                    <!-- {{calSelfTotalPer()}}% -->
                    {{calselfTotal()}}%
                </span>
            </div>
            <div class="col-6" style="padding: 1px;">
                <span class="border-form text-center">
                    <!-- {{calBossTotalPer()}}% -->
                    {{calbossTotal()}}%
                </span>
            </div>
        </div>
    </div>
</div>

<ng-template #imgModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="editLabel">รูปภาพ</h5>
        <button type="button" class="close" (click)="modal.dismiss()">
            <span>&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col">
                <div class="form-group">
                    <small class="text-muted">{{"selected_file"| translate}}</small>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">{{"upload_file"|translate}}</span>
                        </div>
                        <div class="custom-file">
                            <input #fileInput type="file" class="custom-file-input" id="kpiFile" title=""
                                (change)="onFileSelected($event)"
                                accept="{{uploadConfig?uploadConfig.filter.replaceAll('*',''):''}}"
                                [disabled]="statusCompetencyKpiCheck('supervisor_finish')||!step">
                            <label class="custom-file-label col-lg-12 col-md-12 col-sm-12" for="kpiFile">
                                {{kpiformDetail.masform1DetailV2Models[0].assessDetails[imgIndex].image | translate}}
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-2 b-r">
                <div class="form-group " style="margin-top: 20px;">
                    <button type="button" class="btn btn-danger" (click)="resetIMG()"
                        [disabled]="statusCompetencyKpiCheck('supervisor_finish')||!step">
                        {{"cancel"|translate}}</button>
                </div>
            </div>
            <div class="col-12 d-flex justify-content-center" *ngIf="imgUrl">
                <span (click)="getKpiPicture()">
                    <img [src]="imgUrl" alt="Preview" class="img-fluid">
                </span>
            </div>
        </div>
    </div>
</ng-template>
