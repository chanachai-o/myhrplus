<div class="card">
    <div class="card-header bg-myhr">
        <h4>{{pageName | translate}}</h4>
    </div>
    <div class="card-body ">
        <div class="row">
            <div class="col-12">
                <div class="col d-flex justify-content-end">
                    <label class="col-form-label">{{'Year'| translate }} {{currentYear}}</label>
                </div>
            </div>
            <div class="col-12 d-flex justify-content-between">
                <div class="col">
                    <div class="form-group">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" placeholder="{{'Employee ID'| translate }}"
                                aria-describedby="basic-addon1" [ngModel]="employeeSelect.employeeId"
                                (ngModelChange)="findEmployee($event)">
                            <div class="input-group-append">
                                <button class="btn me-0 btn-info" type="button" (click)="openEmployeeModal()">
                                    <i class="fa fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <input type="text" placeholder="{{'Name'| translate }}" class="form-control"
                            [value]="checkWord(employeeSelect.getFullname())" disabled>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <input type="text" placeholder="{{'Position' | translate }}" class="form-control"
                            [value]="checkWord(employeeSelect.position?.getPositionDesc())" disabled>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <input type="text" placeholder="{{getSwaplang('BU1')| translate }}" class="form-control"
                            [value]="checkWord(employeeSelect.bu1?.getBu1Desc())" disabled>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <input type="text" placeholder="{{getSwaplang('BU2')| translate}}" class="form-control"
                            [value]="checkWord(employeeSelect.bu2?.getBu2Desc())" disabled>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center mt-2">
            <div class="col-12">
                <div class="table-responsive">
                    <div class="wrapper">
                        <table
                            class="table table-bordered  table-hover table-striped-myhr table-sm  mb-0 no-wrap v-middle ">
                            <thead class="bg-info ">
                                <tr class="text-white font-weight-normal">
                                    <th rowspan="2" class="align-middle font-weight-normal width-table text-center"
                                        scope="col">
                                        {{"Employee ID"| translate}}
                                    </th>
                                    <th rowspan="2" class="align-middle font-weight-normal width-table text-center"
                                        scope="col">
                                        {{"Name"| translate}}
                                    </th>
                                    <th rowspan="2" class="align-middle font-weight-normal width-table text-center"
                                        scope="col">
                                        {{"Position"| translate}}
                                    </th>
                                    <th rowspan="2" class="align-middle font-weight-normal width-table text-center"
                                        scope="col">
                                        {{getSwaplang("BU1")| translate}}
                                    </th>
                                    <th rowspan="2" class="align-middle font-weight-normal width-table text-center"
                                        scope="col">
                                        {{"status"| translate}}
                                    </th>
                                    <th colspan="3" class="font-weight-normal width-table text-center" scope="col">
                                        {{"Self-Evaluation"| translate}}
                                    </th>
                                    <th colspan="3" class="font-weight-normal width-table text-center" scope="col">
                                        {{"Boss"| translate}}
                                    </th>
                                    <th rowspan="2" class="align-middle font-weight-normal width-table text-center"
                                        scope="col">
                                        {{"Final"| translate}}
                                    </th>
                                </tr>
                                <tr>
                                    <th class="font-weight-normal width-table text-center text-white" scope="col">
                                        {{"Competency"| translate}}
                                    </th>
                                    <th class="font-weight-normal width-table text-center text-white" scope="col">
                                        {{"KPI"| translate}}
                                    </th>
                                    <th class="font-weight-normal width-table text-center text-white" scope="col">
                                        {{"SUM"| translate}}
                                    </th>
                                    <th class="font-weight-normal width-table text-center text-white" scope="col">
                                        {{"Competency"| translate}}
                                    </th>
                                    <th class="font-weight-normal width-table text-center text-white" scope="col">
                                        {{"KPI"| translate}}
                                    </th>
                                    <th class="font-weight-normal width-table text-center text-white" scope="col">
                                        {{"SUM"| translate}}
                                    </th>
                                </tr>
                            </thead>
                            <tbody *ngIf="modalLoad">
                                <tr>
                                    <td colSpan="100%" class="text-center">
                                        <div *ngFor="let item of [1,2,3]"
                                            class="spinner-grow text-info m-t-5 m-r-5 m-b-5 m-l-5" role="status">
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            <tbody *ngIf="!modalLoad&&assessorListFilter().length==0">
                                <tr>
                                    <td colspan="100%" class="font-weight-normal text-center">
                                        {{"No Data Found" |translate}}
                                    </td>
                                </tr>
                            </tbody>
                            <tbody *ngIf="!modalLoad&&assessorListFilter().length>0">
                                <tr *ngFor="let item of assessorListFilter()  | slice: (page-1) * pageSize : ((page-1) * pageSize) + pageSize; let i=index"
                                    style="cursor:pointer">
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{item.apsAssessy.employeeId}}</td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{getText(item.apsAssessy.thFullName,item.apsAssessy.engFullName)}}
                                    </td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{getText(item.apsAssessy.position.tdesc,item.apsAssessy.position.edesc)}}
                                    </td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{getText(item.apsAssessy.bu1.tdesc,item.apsAssessy.bu1.edesc)}}
                                    </td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{getText(item.state,item.stateEng)}}
                                    </td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{(item.stateEng == 'finish' ?
                                        fmtNum(((item.competencyScore||0)*(item.selfCompetencyFinalSum||0))/100)
                                        :0) |customRound}}
                                    </td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{(item.stateEng == 'finish' ?
                                        fmtNum(((item.kpiScore||0)*(item.selfKpiScore||0))/100)
                                        :0)|customRound}}
                                    </td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{(item.stateEng == 'finish' ?
                                        fmtNum(this.fmtNum(((item.kpiScore||0) * (item.selfKpiScore||0)) / 100) +
                                        this.fmtNum((item.competencyScore||0)*(item.selfCompetencyFinalSum||0) /
                                        100))
                                        :0) |customRound}}</td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{(item.stateEng == 'finish' ?
                                        fmtNum(((item.competencyScore||0)*(item.bossCompetencyFinalSum||0))/100)
                                        :0)|customRound}}
                                    </td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{(item.stateEng == 'finish' ?
                                        fmtNum(((item.kpiScore||0)*(item.bossKpiScore||0))/100)
                                        :0)|customRound}}
                                    </td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)">
                                        {{(item.stateEng == 'finish' ?
                                        fmtNum(this.fmtNum(((item.kpiScore||0) * (item.bossKpiScore||0)) / 100) +
                                        this.fmtNum((item.competencyScore||0)*(item.bossCompetencyFinalSum||0) /
                                        100))
                                        :0)|customRound}}</td>
                                    <td class="align-middle text-center" (click)="checkModal||openModal(item)"
                                        *ngIf="user_level != 'HR_Admin'&&user_level != 'HRD_AP'">
                                        {{(item.stateEng == 'finish' ?fmtNum(item.finalScore):0)|customRound}}
                                    </td>
                                    <td class="align-middle text-center" style="min-width: 150px;"
                                        *ngIf="user_level == 'HR_Admin'||user_level == 'HRD_AP'">
                                        <input type="text" class="form-control w-100" [(ngModel)]="item.finalScore"
                                            (ngModelChange)="assessorEdit(item)"
                                            oninput="value = value.replace(/[^0-9]/g, '');">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="d-flex justify-content-end p-2">
                    <select class="form-select m-r-5" style="width: auto" [(ngModel)]="pageSize"
                        (ngModelChange)="page=1">
                        <option [ngValue]="10">{{"Items per page" | translate}}: 10</option>
                        <option [ngValue]="50">{{"Items per page" | translate}}: 50</option>
                        <option [ngValue]="100">{{"Items per page" | translate}}: 100</option>
                    </select>
                    <ngb-pagination [collectionSize]="assessorListFilter().length" [(page)]="page" [pageSize]="pageSize"
                        [maxSize]="3" [rotate]="true">
                        <ng-template ngbPaginationPrevious>{{"Prev" | translate}}</ng-template>
                        <ng-template ngbPaginationNext>{{"Next" | translate}}</ng-template>
                    </ngb-pagination>
                </div>
            </div>
        </div>
        <div class="row justify-content-center" style="padding-top: 16px;"
            *ngIf="(user_level == 'HR_Admin'||user_level == 'HRD_AP')&&!modalLoad">
            <div class="col-12 d-flex justify-content-center">
                <button type="button" style="width: 150px;" class="btn btn-success  text-white mx-1"
                    (click)="saveAssessorList()" [disabled]="saveAssessorListLoad || checkModal">
                    {{"บันทึก" | translate}}
                </button>
            </div>
        </div>
    </div>
</div>
