<div class="card main-content-card card-hover">
    <div class="card-header bg-myhr">
        <h4>{{"Ability Evaluation" | translate}}</h4>
    </div>
    <div class="card-body">
        <!-- Header & Total Count -->
        <div class="d-flex justify-content-end mb-3">
            <span class="badge badge-primary-light">
                {{'all'| translate}}
                <span class="badge text-bg-danger rounded-pill px-2 ms-1">
                    {{data ? data.length : 0}}
                </span>
            </span>
        </div>

        <!-- Desktop Table View -->
        <div class="d-none d-lg-block">
            <div class="table-responsive">
                <table class="table table-hover table-striped-myhr table-sm mb-0 no-wrap v-middle">
                    <thead class="thead-light">
                        <tr class="text-center">
                            <th scope="col" class="text-start">{{"Employee Name" | translate}}</th>
                            <th scope="col" class="text-center">{{"systemcode.child.status" | translate}}</th>
                            <th scope="col" class="text-center">{{"Status Assessor" | translate}}</th>
                            <th scope="col" class="text-center">{{"Date of valuation" | translate}}</th>
                            <th scope="col" class="text-center" style="width: 5%;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (loading) {
                        <tr>
                            <td colspan="5" class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </td>
                        </tr>
                        } @else {
                        <!-- Hardcoded example rows, replace with @for loop when data is available -->
                        <tr>
                            <td>นางสาวมณี กาลพันธา</td>
                            <td class="text-center"><span class="badge bg-warning text-dark">ยังไม่ได้ประเมิน</span>
                            </td>
                            <td class="text-center">ผู้ประเมินคนที่ 1</td>
                            <td class="text-center">-</td>
                            <td class="text-center">
                                <button type="button" class="btn btn-info btn-sm btn-circle"
                                    (click)="openDialog(dialog,'')">
                                    <i class="mdi mdi-magnify"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>นางสาวสุวรรณา เกิดอยู่</td>
                            <td class="text-center"><span class="badge bg-info">ผู้ถูกประเมินบันทึกร่างแล้ว</span></td>
                            <td class="text-center">ประเมินตัวเอง</td>
                            <td class="text-center">09-02-2020</td>
                            <td class="text-center">
                                <button type="button" class="btn btn-info btn-sm btn-circle"
                                    (click)="openDialog(dialog,'','ประเมินตัวเอง')">
                                    <i class="mdi mdi-magnify"></i>
                                </button>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Mobile Card View -->
        <div class="d-lg-none">
            @if (loading) {
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
            } @else {
            <!-- Hardcoded example cards, replace with @for loop when data is available -->
            <div class="card info-card-mobile mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="mb-2">
                            <h6 class="mb-0">นางสาวมณี กาลพันธา</h6>
                            <small class="text-muted">ผู้ประเมินคนที่ 1</small>
                        </div>
                        <button type="button" class="btn btn-primary btn-sm btn-icon" (click)="openDialog(dialog,'')">
                            <i class="mdi mdi-magnify"></i>
                        </button>
                    </div>
                    <div class="details-grid-sm">
                        <div class="detail-item">
                            <small>{{"systemcode.child.status" | translate}}</small>
                            <strong><span class="badge bg-warning text-dark">ยังไม่ได้ประเมิน</span></strong>
                        </div>
                        <div class="detail-item">
                            <small>{{"Date of valuation" | translate}}</small>
                            <strong>-</strong>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card info-card-mobile mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="mb-2">
                            <h6 class="mb-0">นางสาวสุวรรณา เกิดอยู่</h6>
                            <small class="text-muted">ประเมินตัวเอง</small>
                        </div>
                        <button type="button" class="btn btn-primary btn-sm btn-icon"
                            (click)="openDialog(dialog,'','ประเมินตัวเอง')">
                            <i class="mdi mdi-magnify"></i>
                        </button>
                    </div>
                    <div class="details-grid-sm">
                        <div class="detail-item">
                            <small>{{"systemcode.child.status" | translate}}</small>
                            <strong><span class="badge bg-info">ผู้ถูกประเมินบันทึกร่างแล้ว</span></strong>
                        </div>
                        <div class="detail-item">
                            <small>{{"Date of valuation" | translate}}</small>
                            <strong>09-02-2020</strong>
                        </div>
                    </div>
                </div>
            </div>
            }
        </div>

        <!-- Pagination -->
        <div class="d-flex flex-wrap justify-content-end align-items-center p-2 mt-3">
            <select class="form-select me-2 mb-2 mb-md-0" style="width: auto" [(ngModel)]="pageSize"
                (ngModelChange)="page=1">
                <option [ngValue]="10">{{"Items per page"| translate}}: 10</option>
                <option [ngValue]="50">{{"Items per page"| translate}}: 50</option>
                <option [ngValue]="100">{{"Items per page"| translate}}: 100</option>
            </select>
            <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [pageSize]="pageSize" [maxSize]="3"
                [rotate]="true" [boundaryLinks]="true">
                <ng-template ngbPaginationPrevious>{{"Prev"| translate}}</ng-template>
                <ng-template ngbPaginationNext>{{"Next"| translate}}</ng-template>
            </ngb-pagination>
        </div>
    </div>
</div>

<!-- Evaluation Detail Modal -->
<ng-template #dialog let-modal>
    <div class="modal-header">
        <h5 class="modal-title">{{"Ability.1" | translate}}</h5>
        <button type="button" class="btn-close btn-close-white" (click)="modal.close()" aria-label="Close"></button>
    </div>
    <div class="modal-body" [perfectScrollbar]="config">
        <!-- Profile Header -->
        <div class="card profile-header-card mb-3">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-3 col-12 text-center">
                        <img appShowLoading *ngIf="status && empProfile?.picture; else blankImage"
                            src="{{ empProfile.getPictureUrl() }}" class="rounded-circle img-fluid profile-picture"
                            alt="Employee Picture">
                        <ng-template #blankImage>
                            <img src="assets/images/users/defaultperson.jpg" alt="Employee Picture"
                                class="rounded-circle img-fluid profile-picture" />
                        </ng-template>
                    </div>
                    <div class="col-md-9 col-12">
                        <div class="profile-details mt-3 mt-md-0">
                            <div class="row">
                                <div class="col-lg-6 col-12 mb-2">
                                    <small class="text-muted">{{"Grade" |translate}}</small>
                                    <h6>-</h6>
                                </div>
                                <div class="col-lg-6 col-12 mb-2">
                                    <small class="text-muted">{{"Grade Overview"| translate}}</small>
                                    <h6>-</h6>
                                </div>
                                <div class="col-lg-6 col-12 mb-2">
                                    <small class="text-muted">{{"Evaluation Period"| translate}}</small>
                                    <h6>01 ม.ค. 2562 - 30 ก.ย. 2562</h6>
                                </div>
                                <div class="col-lg-6 col-12 mb-2">
                                    <small class="text-muted">{{"Evaluation Form Name"| translate}}</small>
                                    <h6>SBL1</h6>
                                </div>
                                <div class="col-lg-6 col-12 mb-2">
                                    <small class="text-muted">{{"systemcode.child.status"| translate}}</small>
                                    <h6>ผู้ประเมินคนที่ 1</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rating Scale Card -->
        <div class="card info-card mb-3">
            <div class="card-header bg-myhr">
                <h5 class="card-title mb-0">{{"Rating Scale and Definition" | translate}}</h5>
            </div>
            <div class="card-body">
                <div class="col-12 text-center mb-3">
                    <h5>{{'Evaluation' | translate}}</h5>
                    <div class="d-flex justify-content-center gap-3">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="evalCheck1">
                            <label class="form-check-label" for="evalCheck1">Ability</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="evalCheck2">
                            <label class="form-check-label" for="evalCheck2">Skill</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="evalCheck3">
                            <label class="form-check-label" for="evalCheck3">MBO</label>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm table-bordered definition-table">
                        <thead class="table-light">
                            <tr class="text-center">
                                <th>{{"Rating" | translate}}</th>
                                <th>{{"Results" | translate}}</th>
                                <th>{{"Definition" | translate}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Replace with @for loop if data is dynamic -->
                            <tr>
                                <td class="text-center fw-bold">5</td>
                                <td>สูงกว่าความคาดหวังมาก<br><small>Greatly Exceeds Expectations</small></td>
                                <td class="text-wrap">ไม่ว่าจะมีสถานการณ์ที่เลวร้ายหรือมีความเสี่ยง
                                    ได้แสดงให้เห็นถึงความสามารถและบทบาทได้ตามที่คาดหวังไว้อย่างสม่ำเสมอ
                                    บางครั้งแสดงความสามารถและบทบาทของตนเองได้สูงกว่าระดับที่คาดหวังไว้<br>No matter how
                                    bad or risky the situation is, always demonstrates the ability and role expected.
                                    Sometimes demonstrates higher level of his/her ability and role expected.</td>
                            </tr>
                            <tr>
                                <td class="text-center fw-bold">4</td>
                                <td>สูงกว่าความคาดหวัง<br><small>Exceeds Expectations</small></td>
                                <td class="text-wrap">ในสถานการณ์ปกติ
                                    แสดงให้เห็นถึงความสามารถและบทบาทของตนเองได้ตามที่คาดหวังไว้อย่างสม่ำเสมอ (100%)
                                    คุณภาพของงานแต่ละงานมีความแน่นอนคงที่
                                    และหัวหน้างานไม่จำเป็นต้องช่วยเหลือหรือคอยระวังติดตามดูแล<br>In normal situation,
                                    always(100%) demonstrates the ability and role expected. His/her quality of each
                                    task has stability and his/her superior does not need to support or monitor
                                    proactively.</td>
                            </tr>
                            <tr>
                                <td class="text-center fw-bold">3</td>
                                <td>ตามมาตรฐานปกติของความคาดหวัง<br><small>Meets Normal Expectations</small></td>
                                <td class="text-wrap">ในสถานการณ์ปกติ
                                    แสดงให้เห็นถึงความสามารถและบทบาทของตนเองได้ตามที่คาดหวังไว้ได้ในระดับปกติทั่วไป
                                    (70~80%) แต่หัวหน้างานบางครั้งต้องช่วยเหลือหรือคอยระวังติดตามดูแล<br>In normal
                                    situation, generally(70~80%) demonstrates the ability and role expected. But,
                                    his/her superior sometimes needs to monitor or support actively.</td>
                            </tr>
                            <tr>
                                <td class="text-center fw-bold">2</td>
                                <td>ต่ำกว่าความคาดหวัง<br><small>Less than Expectations</small></td>
                                <td class="text-wrap">ในสถานการณ์ปกติ
                                    แสดงให้เห็นถึงความสามารถและบทบาทของตนเองได้ตามที่คาดหวังไว้ได้ในบางครั้ง (50%)
                                    แต่หัวหน้างานยังจำเป็นต้องสอนงานและแนะนำอยู่<br>In normal situation, sometimes(50%)
                                    demonstrates the ability and role expected. He/she does not make big problems, but
                                    his/her superior still needs to direct or advise.</td>
                            </tr>
                            <tr>
                                <td class="text-center fw-bold">1</td>
                                <td>ต่ำกว่าความคาดหวังมาก<br><small>Much Less than Expectations</small></td>
                                <td class="text-wrap">แม้ว่าจะเป็นสถานการณ์ที่ปกติ แต่แทบจะ (30%)
                                    ไม่แสดงให้เห็นถึงความสามารถและบทบาทของตนเองได้ตามที่คาดหวังไว้<br>Even if he/she is
                                    in normal situation, rarely (30%) demonstrates the ability and role expected.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Part 1: Personnel Info -->
        <div class="card info-card mb-3">
            <div class="card-header bg-myhr">
                <h5 class="card-title mb-0">{{"Part.1" | translate}}</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm table-bordered personnel-info-table">
                        <thead class="table-light">
                            <tr class="text-center">
                                <th></th>
                                <th>{{"Evaluatee" | translate}}</th>
                                <th>{{"1st-Evaluation" | translate}}</th>
                                <th>{{"2nd-Evaluation" | translate}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Replace with @for loop if data is dynamic -->
                            <tr>
                                <td class="fw-bold table-light">{{'Employee ID' | translate}}</td>
                                <td>100004</td>
                                <td>410305</td>
                                <td>

                                </td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'dashboard.employee.name' | translate}}</td>
                                <td>นางสาวสราลี เกิดอยู่</td>
                                <td>นางสาวสุวรรณา เกิดอยู่</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'Division' | translate}}</td>
                                <td>IMPLEMENT</td>
                                <td>IMPLEMENT</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'Department' | translate}}</td>
                                <td>Project</td>
                                <td>Project</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'systemcode.bu3' | translate}}</td>
                                <td>Piswin</td>
                                <td>Piswin</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'Position in Organization Chart' | translate}}</td>
                                <td>Consultant Manager</td>
                                <td>Consultant Manager</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'Grade' | translate}}</td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'Skill Type' | translate}}</td>
                                <td>Consultant Manager</td>
                                <td>Consultant Manager</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'systemcode.child.status' | translate}}</td>
                                <td>ยังไม่ได้ประเมิน</td>
                                <td>ยังไม่ได้ประเมิน</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'Date of valuation' | translate}}</td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="fw-bold table-light">{{'Total scores (%)' | translate}}</td>
                                <td>0.00</td>
                                <td>0.00</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Part 2: Evaluation Items -->
        <div class="card info-card mb-3">
            <div class="card-header bg-myhr">
                <h5 class="card-title mb-0">{{"Part.2" | translate}}</h5>
            </div>
            <div class="card-body">
                <div class="evaluation-items-container">
                    <!-- This section should be converted to a responsive card list for mobile -->
                    <!-- Example for one item -->
                    <div class="evaluation-item-card">
                        <div class="item-header">
                            <span class="item-number">1</span>
                            <div class="item-title">
                                <h6 class="mb-0">การปฏิบัติตามระเบียบวินัยและจริยธรรม</h6>
                                <small class="text-muted">ทัศนคติต่อการทำงาน</small>
                            </div>
                            <span class="item-weight">30.00%</span>
                        </div>
                        <div class="item-body">
                            <p class="item-definition">เพื่อให้ได้รับความน่าเชื่อถือและเป็นที่เคารพจากทั้งบริษัท
                                จึงต้องปฏิบ้ติตามระเบียบวินัย และให้ความสำคัญกับผู้อื่นและสังคม</p>
                            <div class="item-rating-grid">
                                <div class="rating-group">
                                    <label class="form-label">{{"Self-Evaluation" | translate}}</label>
                                    <select class="form-select form-select-sm">
                                        <option selected>{{"Rate" | translate}}</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                                <div class="rating-group">
                                    <label class="form-label">{{"1st-Evaluation" | translate}}</label>
                                    <select class="form-select form-select-sm">
                                        <option selected>{{"Rate" | translate}}</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Repeat for other items -->
                </div>
            </div>
        </div>

        <!-- Part 3: Comments -->
        <div class="card info-card">
            <div class="card-header bg-myhr">
                <h5 class="card-title mb-0">{{"Part.3" | translate}}</h5>
            </div>
            <div class="card-body">
                <div class="comment-section">
                    <label class="form-label fw-bold">{{"Evaluatee" | translate}}: นางสาวสราลี เกิดอยู่</label>
                    <textarea rows="3" class="form-control" [placeholder]="'Evaluation Comment' | translate"></textarea>
                </div>
                <hr>
                <div class="comment-section">
                    <label class="form-label fw-bold">{{"1st-Evaluation" | translate}}: นางสาวสุวรรณา เกิดอยู่</label>
                    <p class="form-text">ผู้ประเมินแสดงความคิดเห็นแก่ผู้ถูกประเมินเกี่ยวกับจุดแข็งจุดอ่อน
                        การให้ข้อมูลป้อนกลับ (Feedback) เกี่ยวกับผลการปฏิบัติงานของพนักงานที่ถูกประเมิน บอกความคาดหวัง
                        และให้คำแนะนำที่จะช่วยพัฒนาปรับปรุงความสามารถในการประเมินรอบถัดไปได้</p>
                    <textarea rows="3" class="form-control mb-2"
                        [placeholder]="'Evaluation Comment' | translate"></textarea>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="feedbackRadio" id="feedbackRadio1">
                        <label class="form-check-label" for="feedbackRadio1">ผู้ประเมินคนที่ 1
                            ยืนยันว่าได้มีการให้ข้อมูลป้อนกลับพนักงานแบบ two-way communication</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="feedbackRadio" id="feedbackRadio2">
                        <label class="form-check-label" for="feedbackRadio2">ผู้ประเมินคนที่ 1
                            ไม่ได้มีการให้ข้อมูลป้อนกลับพนักงานแบบ two-way communication</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.close()">{{"Close"| translate}}</button>
        <button type="button" class="btn btn-success" (click)="modal.close()">{{"Save"| translate}}</button>
    </div>
</ng-template>